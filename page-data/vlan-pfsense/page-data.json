{"componentChunkName":"component---src-templates-post-js","path":"/vlan-pfsense","result":{"data":{"markdownRemark":{"html":"<p>My current set-up has <a href=\"https://www.pfsense.org/\">pfSense vitualised</a> on an <a href=\"/all-in-one-esxi-server/\">all-in-one ESXi host</a> providing networking to my entire infrastructure. This infrastructure is both virtual and physical and therefore denying guest access to them is very important so that not anyone can just type an IP address into their browser and begin changing settings.</p>\n<p>We can do this through the use of <a href=\"http://en.wikipedia.org/wiki/Virtual_LAN\">VLANs</a> to restrict users to one particular network while having Administrator access to all. pfSense has the ability to set up VLANs and deny access between them. In addition to this, our <a href=\"http://www.dlink.com.au/business-solutions/16-port-gigabit-easysmart-switch\">managed/smart network switch</a> and <a href=\"http://www.vmware.com/products/vsphere/features/distributed-switch\">VMware vSwitch</a> support this feature.</p>\n<!-- more -->\n<h2 id=\"vlan-prerequisites\" style=\"position:relative;\"><a href=\"#vlan-prerequisites\" aria-label=\"vlan prerequisites permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>VLAN Prerequisites</h2>\n<p>Have some VLAN numbers in mind. Something memorable if possible. Possible VLAN numbers ranged from 0 to 4095 but never use:</p>\n<ul>\n<li>0 - user priority data</li>\n<li>1 - native VLAN</li>\n<li>4095 - automatically discarded</li>\n</ul>\n<p>Here are the VLANs I chose for myself that were easy to remember and had a common separation of components.:</p>\n<ul>\n<li><strong>Management VLAN 10</strong>: For Administrative operations. Access to all other VLANs. Where the infrastructure and my main computers will be.</li>\n<li><strong>User VLAN 20</strong>: Gives access to file server and little bit of infrastructure like a printer and sound system. Mainly for trusted family and friends.</li>\n<li><strong>Guest VLAN 30</strong>: Internet Access only. No access to anything but the Internet.</li>\n<li><strong>Local VLAN 40</strong>: No Internet Access. Just a plain old local area network for whatever purpose.</li>\n<li><strong>Voice VLAN 50</strong>: VoIP devices go here. Traffic will be prioritised over other VLANs</li>\n<li><strong>Surveillance VLAN 60</strong>: When I get some cameras and surveillance cameras this will be there they go.</li>\n</ul>\n<h2 id=\"lets-begin-to-vlan\" style=\"position:relative;\"><a href=\"#lets-begin-to-vlan\" aria-label=\"lets begin to vlan permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Let's Begin to VLAN</h2>\n<p><strong>1.</strong> Log into pfSense and go to 'Interfaces -> VLANs'.\nCreate a new VLAN using your LAN interface as the parent interface. I only have two NICs and the WAN NIC is certainly not going to be a VLAN.</p>\n<p>Give your VLAN a number/tag (10) and a short description of what it is (e.g. Management).</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 778px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5126868f5d765f7e03c8376b4af342e5/a1189/12.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.699530516431924%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2UlEQVQY033LT2vCMAAF8HxZoX9O6nCfTYQpDLwoI+6W2aZNk6ytNqlZa9qRNpXNy2Ddfjwe7/LA8mG+elwsHWc1mWx8f+16a9d9cpyN72+n0z8zmz17HthD+PJ6QBjTLEvPRcw4eU9ZlqdnUbefw7/AfrfDIQ6OxygMCobL8lJXlb5e66pqtO67rjPm3r8DIIToyxsOgxOL4ogwyqSUhRAfSjVNo7U2xvRjAEKIEBLHhDGac5IQyimXQiqlLmUpCvFNjp+ttfdle0uSJD/lnPG2bYdhsD+Mnm+b4DvgT6Py7gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Create a VLAN\"\n        title=\"Create a VLAN\"\n        src=\"/static/5126868f5d765f7e03c8376b4af342e5/a1189/12.png\"\n        srcset=\"/static/5126868f5d765f7e03c8376b4af342e5/53f68/12.png 213w,\n/static/5126868f5d765f7e03c8376b4af342e5/df70d/12.png 425w,\n/static/5126868f5d765f7e03c8376b4af342e5/a1189/12.png 778w\"\n        sizes=\"(max-width: 778px) 100vw, 778px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Continuing creating VLANs to your heart's content until you have enough.</p>\n<p><em>Finished list</em>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 786px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4f09b46a8c2241f50cbd4fbbd759bcb7/d703b/22.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.80281690140845%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABhElEQVQY0z2OXU+bUACGj974EaP7kSbuT8x40/oPuths3rik0wtpWqp2FTBygDpWROGUj8M5CEd7pYmDqmPQYUiTvXny5rl5kxdwHNfl+d5Jr9Ppcly7w3f7/bMb2x5o6snX/fNWq68oA1k+vZBkXX9+e0uLIn19TdM0SRIgiZJpmgghw7iGUDZNc+x5Cs+3Pm236/Xe7m6vXp/D12rdWq29syMfH49dF/s+eHp8yvNiNpu9TF+yP1mR52VZOgff9tc3mktLDQAaAHz+z+JiA4CjzU1BhSEhYPIwybKsKPLkdzJNp3+z7F9Zut8Pv2x82Ftebq6uNldWqp6ztra3sHD0cescXlbjiFLGYsZYHMdRFDHG7icPBCFbFO0LyZYkJEmWKFiCYInirSDYgmBAaCNEKQXwx0DVhoqiKlDVNE2uAodX+tVo9NMwNH001H9ZjmM57u3YsV0PeT4mhARVQEDo3EkQEEIwxrhyEvg4wBj7PvZwSGlIKSXkjoYhDaMoiquv7B1iOjM7M+p+4AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"all vlans\"\n        title=\"all vlans\"\n        src=\"/static/4f09b46a8c2241f50cbd4fbbd759bcb7/d703b/22.png\"\n        srcset=\"/static/4f09b46a8c2241f50cbd4fbbd759bcb7/53f68/22.png 213w,\n/static/4f09b46a8c2241f50cbd4fbbd759bcb7/df70d/22.png 425w,\n/static/4f09b46a8c2241f50cbd4fbbd759bcb7/d703b/22.png 786w\"\n        sizes=\"(max-width: 786px) 100vw, 786px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><strong>2.</strong> Go to 'Interfaces -> Assign' and add some new Interfaces for your new VLANs. We will worry about renaming and configuring them next.</p>\n<p><em>Assign Network Ports</em>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 778px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bdc8521928b07207ec1bbbc30c44ce80/a1189/32.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.61971830985916%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABKElEQVQY023L3U6DMABAYd7/WcyyDPTOTO8cE0SGE4RCaUvbBTZIJi79W82IMRr9Ls7dcUhR4CJvKvgWx9soen2KsueoSFPGOWXfOOecUqq1thMhBOfcWT8Gy7v7h5V/u1x6N9cLz72azVzP9Tx34S7ci0s9z53P50mSVFUFANjtdsMwOEEQxPGGEEIwZpRuty/rtb9JNmVZorrGGDPG6IRRCiEsJ2maFkXh5Hn+Pn5Ya8/ns7W2H4aaIIhQ09C+76WU9g9jTBgGZVk6WZZ13d5oLYSQSrVtW2MEEcSEtG03jqNSSv4mhAjD8Gs+HA7WWqWU1nrf7TEhCKOGsuPxeDqdjDH6B2OMlNL3VwAABwAAYU0pbSYQQlACAEBVVQghjHHznzzPMcafdOp1bOQzvZgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Assign Network Ports\"\n        title=\"Assign Network Ports\"\n        src=\"/static/bdc8521928b07207ec1bbbc30c44ce80/a1189/32.png\"\n        srcset=\"/static/bdc8521928b07207ec1bbbc30c44ce80/53f68/32.png 213w,\n/static/bdc8521928b07207ec1bbbc30c44ce80/df70d/32.png 425w,\n/static/bdc8521928b07207ec1bbbc30c44ce80/a1189/32.png 778w\"\n        sizes=\"(max-width: 778px) 100vw, 778px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><strong>3.</strong> Pick an interface under the 'Interfaces' menu and enable it. This will give you the ability to configure it.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 770px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8aa461e4b9ccff4baf5b9d0188083122/5b400/42.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 110.32863849765258%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAIAAABPIytRAAAACXBIWXMAAAsTAAALEwEAmpwYAAADeElEQVQ4y32UW0/bSBSA/V/7hkrf+lCah92XSsulaBekoq0aHipR2qoguiVhoZCSpBnbY3s8vszV40tsYicK/2FlG6RKoP30eTxj+4x9dGashZ8/m6+37L03+vof12tr405n1OkMX778H0edzuD58xQAzTo7Gx8c4F7POTmBnz4N9ruX797ph4fo+Nj58sV+TOfoyPz4cUqIJtOEKJUWRXwzU2lEWSCz/Ga5vFku8/lCZFkymz1UFcViudQ4Y7ZlQdP0MKaEYBcHnu9h7GMPu27g+1KIh3LGyrLUfN+/Hl7rACDkCk7zPKvm87Qhy7JYKc654JwzJn+Bc15VlaZUFASBlFLFMSM+DT1eT90QSRIGtgVtCD0XqShS90gp22AlZVSjVOB7lmWYpgF0fQLABADkIowxQsjzPKVUdI8Qog5ue810MaM+I36kFKE0DMMgCOqWhHUbBn7g+0FACAkJEULM53NNNAk0L1ZhEGAv5GrKheSM1dkKwZsMeC1vr9TDNudYKcG55FzJCCMHGrqDvAkALkIuQhghz3VdhDzs4vrseBi7CPkYV2WpySzFQtAkScpSVVUQx3SakSz145gXebpYJA9MFwtVVfPbW837+o/+Zg/ud2H33Xh7e7SxOdrYGK6vD9fXR5ubjzre2vrx6lUMoWYdHZ1vbOrdrvX+vf7XtvHna2vvb6/bdd++1Xd3W8HOjr6zAxrrzu7uaGsrdRwtmma+lJ4QUVHEs4KmMVExiSJZFCyfsmnG81wURdPWsjyPZrN4Pq8/O0lTGd2VnxAKbduEJtCBYZrQspDr1qWhdXlawjBsy1BWlWbv7/94sTb87fd/V1YuVlYun65ertZerT4bPKuth09Xr1bvbO/2nzyRg4EWYUwmgOoGnUzcwaB/+KF3cNA7+HB1fDz+9m349QT0z8BZ/2fvFPT7k17v5+mpftaH5+dFEmtpnkdJotI0nk6pFGPDABDqtj2xILBMAE2PkJAzjxCfUp/SgHEiOBGims+1JElks7hVFAW+f3l5dXFxcfH9u24YCDmWZdm2XbeO49gWch3DNCA0bceuqvKX4Hpj+IZpANPQTcOE0HGaVVbrOgg5CGHPo5RSxgghzfKMYyFEG08IaR9CrssZJ4RQWh8thBDGWLurOOf1z6Asy6IobhryPE/vyGaPcXNPnue3t7f/Ad7SGWOJ3V+uAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Configure Interface\"\n        title=\"Configure Interface\"\n        src=\"/static/8aa461e4b9ccff4baf5b9d0188083122/5b400/42.png\"\n        srcset=\"/static/8aa461e4b9ccff4baf5b9d0188083122/53f68/42.png 213w,\n/static/8aa461e4b9ccff4baf5b9d0188083122/df70d/42.png 425w,\n/static/8aa461e4b9ccff4baf5b9d0188083122/5b400/42.png 770w\"\n        sizes=\"(max-width: 770px) 100vw, 770px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Give the interface an IPv4 address (gateway). Make sure it is unique and outside the address range of your other networks/interfaces. I chose to give each VLAN a <em>10.0.X.0</em> address, where X is the VLAN number.</p>\n<ul>\n<li>LAN is 10.0.100.1/24 (will never be used)</li>\n<li>VLAN 10 is 10.0.0.1/23 (covers 10.0.0.1 - 10.0.1.255)</li>\n<li>VLAN 20 is 10.0.2.1/24</li>\n<li>VLAN 30 is 10.0.3.1/24</li>\n<li>VLAN 40 is 10.0.4.1/24</li>\n</ul>\n<p>You can return to the Interfaces page to confirm your VLANs.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 779px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cb2de4e896c8e7a6b0105755b9ba7d9b/a3e85/51.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.61971830985916%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABKUlEQVQY02XNWW+CQBQFYP7/j6nVCGn70iUmPhQ0BVxmgVm4YLQD2rFR4jjSSLUx6ZfzdHNOrgOEZoQUjCWTmEwmOIpoHMk0rdZrVaryQlVVpZSy9ti06rpeLApnNB6/DQbvvv/8+tL33Ienx77r3nU63e6957mu27/Ec3u9HkIIAIQQq9VKa+2MgiAMw0zKNE05Z4JzNJ8Ph0M/CKbTKcY4SSi/opSSFkKIUurMZjMA+NK6udrvdxKkyKSQ8lOpuq5/76fTX6WJohBj7BCCEZqrsjy0jDFaawDIi0Jmcrlcfm+3xpjDDWNMGH6cP0dxFMVx0zTHlrVWa80Y51KmLF1vNrvdzlp7vGGtDQIfY+QkSUIozfO8uIIM2HnNGWNSSgAo/sEYCyF+AJ2adMhaY8wnAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Confirm VLANs\"\n        title=\"Confirm VLANs\"\n        src=\"/static/cb2de4e896c8e7a6b0105755b9ba7d9b/a3e85/51.png\"\n        srcset=\"/static/cb2de4e896c8e7a6b0105755b9ba7d9b/53f68/51.png 213w,\n/static/cb2de4e896c8e7a6b0105755b9ba7d9b/df70d/51.png 425w,\n/static/cb2de4e896c8e7a6b0105755b9ba7d9b/a3e85/51.png 779w\"\n        sizes=\"(max-width: 779px) 100vw, 779px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><strong>4.</strong> Enable any DHCP servers for the VLANs interfaces if you need it. I have configured half of each range to be DHCP and the other half to be static.</p>\n<p><em>Configure DHCP on any/all VLANs</em>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 785px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b8b1e05997eaab8baae21b4725781991/18baa/61.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.98591549295775%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA3ElEQVQY033PS26DMBCAYd//SiwKhUB4OBgn2ON5kJAEluUKlUmrSq3UT6NZzq9ReZ6nWZq9Z29pmmVxN03jvV/Xddu2j3+peZ55JzutdVEUdV23bXus67brACD8AQBEpIgIAESEiEKA6lgdykNZlfp0MsZYa81gBjtYa733IsLfpmlS4ziWVeWcQ0Tnxk5r7z0ifhVes/tVZmZlrU2SpO97FgHvurbpe0NEzIwBmJApRmKTfiCiiChCtOczMxMxgruiCwGXZbnebu5iyF8C8nN53h/3EALG16LX9U/qOC/wc8n6tgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Configure DHCP\"\n        title=\"Configure DHCP\"\n        src=\"/static/b8b1e05997eaab8baae21b4725781991/18baa/61.png\"\n        srcset=\"/static/b8b1e05997eaab8baae21b4725781991/53f68/61.png 213w,\n/static/b8b1e05997eaab8baae21b4725781991/df70d/61.png 425w,\n/static/b8b1e05997eaab8baae21b4725781991/18baa/61.png 785w\"\n        sizes=\"(max-width: 785px) 100vw, 785px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><strong>5.</strong> Go to Firewall -> Rules and select a VLAN interface. Currently each VLAN cannot access anything, like ANYTHING at all without any 'pass' rules. Play with this until you are happy with it. I will share my rules in a future post.</p>\n<p><strong>6.</strong> Log into your VMware vSphere Client and go to 'Configuration > Networking' under your ESXi host.</p>\n<p>First edit your LAN Port Group so it has access to All (4095) VLAN groups. Doing so allows pfSense to configure VLAN access to VMware. Imagine you are configuring a switch, except this one is virtual. Allowing the LAN 'port' on the switch to access all VLANs transforms it into a 'trunk' or 'tagged' VLAN port which is able to carry all VLAN data.</p>\n<p><em>LAN VLAN Access</em>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 526px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/24d865528dee83221ee087da0c66fb46/55e98/lan1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.863849765258216%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEElEQVQY02XQTWuDQBAG4P3vakAIHkLpodT06iWFhoYQ+j90d40fu85qoqurG+u5uEJI6MMwl2FehkHH4+nwfdh/7bfbD8/zXNd1HMe2LduwLGu1Wrmuu16vN5uN7/tBEHzudj/vr6e3FwQAnDEAKEvBGGeMMc6hAM45gFBKdQ9aQ7Ztp285CBTHZ4IxwZQQEtM4y3JmspIk5UXxuLrkqDlP6aFPkjOCAiillNAszdu21VpLKQFAKdU0zfVZXdf3LIwxqkoRRSQMwzhOluWqukQRFqIcx/H3wTRNy9la62EYCCFIykaAgALynNXXWiklpaxml9v4ZJqmi7E8glKKhllvauj7Xhm90f2zjJaepukfyBVruvzWWvEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"LAN VLAN Access\"\n        title=\"LAN VLAN Access\"\n        src=\"/static/24d865528dee83221ee087da0c66fb46/55e98/lan1.png\"\n        srcset=\"/static/24d865528dee83221ee087da0c66fb46/53f68/lan1.png 213w,\n/static/24d865528dee83221ee087da0c66fb46/df70d/lan1.png 425w,\n/static/24d865528dee83221ee087da0c66fb46/55e98/lan1.png 526w\"\n        sizes=\"(max-width: 526px) 100vw, 526px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><strong>7.</strong> Begin to create additional Port Groups for VLANs. Click 'Add Networking...' in the top right hand corner.</p>\n<p>a. Choose 'Virtual Machine' as the connection type.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 770px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5715ca16ce472cec1877fc9d41461f90/5b400/13.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.61971830985916%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/UlEQVQY033O206EMBAGYN7/zbxYwQ0GWiAc2plSsEBLiyFkqS6SjUbjdzGHiz8zwXP4FIUvl8slSZKU0GtM4tf0GpP0J0IIpTTLsjzPi6I4ShFYayc9Igo9aeecs+59WZy182yX+2qdu/dt2/wvAasZcglMGGOsteqgtZ7n2Xwz/yVgNTR5i023bdu6rlVdEULKslRKDf9SSgVKvXnv93333q/ryhgLo4hSCoCcc+DAGeeMt600xmitvx7RehqGIVBKee9vt0e4CcMwy/K6bhAROAgUCICAAoUQAlEAgJRyHMcz/Ljcd11V1WVZMsbFoRXt2c+5lVL2ff8Z/gBZioEMQ6w8zQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Connection Type\"\n        title=\"Connection Type\"\n        src=\"/static/5715ca16ce472cec1877fc9d41461f90/5b400/13.png\"\n        srcset=\"/static/5715ca16ce472cec1877fc9d41461f90/53f68/13.png 213w,\n/static/5715ca16ce472cec1877fc9d41461f90/df70d/13.png 425w,\n/static/5715ca16ce472cec1877fc9d41461f90/5b400/13.png 770w\"\n        sizes=\"(max-width: 770px) 100vw, 770px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>b. Select the same vSwitch as the LAN Port Group we edited earlier</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6d7d343eb0c8b4a130d0d799d32d8bfb/ca1dc/23.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.47887323943662%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABVUlEQVQoz22RXXOjIBSG/f//qr3YJm13b2oqXxoQEkyiFFQwVZAd47ST3elzhnNueOc8AwkA7yADm+329ffr06+nh4fH55cXhDCAaAFjjMkyEUYIM8qklMfjUUpZVVUipYwxjuP4eWOapuDDNPnpC++Dn/yNMM9zvCN532UlPpFUXKpmHD8rKTHCJM/z5RRFsSeEwMUCAwARRJQyzoUQgpc8KYqcswMtWNOoGOP5fMaY3CQhJgQiiDGRUh4OiypjrK5r/UWCEIoxhhBWE2t7Sveb7eZtt5NSUkZLIZRSdV0bY5xz9+YJAOA7PM/zcF0KFikXZdt21tq+75VSvORKqa5ru67T2nxo7b1PIIRrbO3Ouaqq3tKUi4O1VhttjNFGqw/Vtq1zQwjLs60kWZbdb75er7Z3KfyTF7hplFJLu1wu+z09nc5db9drP4eHYfjvP+6Z/+UvnIb0557tKg0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"vSwitch\"\n        title=\"vSwitch\"\n        src=\"/static/6d7d343eb0c8b4a130d0d799d32d8bfb/ca1dc/23.png\"\n        srcset=\"/static/6d7d343eb0c8b4a130d0d799d32d8bfb/53f68/23.png 213w,\n/static/6d7d343eb0c8b4a130d0d799d32d8bfb/df70d/23.png 425w,\n/static/6d7d343eb0c8b4a130d0d799d32d8bfb/ca1dc/23.png 680w\"\n        sizes=\"(max-width: 680px) 100vw, 680px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>c. Enter the Network Label and its associated VLAN ID.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 696px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/51df9b50d36d0c3c57b5fc7587fe2d6f/64252/33.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.375586854460096%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABNElEQVQY02XPW2vCMBQH8H5+mXvZmBoRX4S9CJvQfYY97H3aTLzENgu0uTRtc6mNkVY2dPs9HA4hyTn/4GXxHIZvr4vFfD4fDAf9/n2vd/fw+DQcAjACI9AadQAA4/F4MplMp9PZbBaGYUAIkTLf7XcJxkmSxIcYoYMQoqpUpVRVKa21MVYpbW3tbwXb7c7V3lTHY93Ux9ra2lqrlCqLUnWstcboS6+vGGMCuFx/faSf70mCiDY6y+hqtYIRPKCYMZ5lKUIIY8w5Z7copcF2s2GcCcGFEM45znnUgoSQspB7nC7X+yxNpSxkhxDCeXuZMRZEUeS9d85dYkgpKWO0+zsXgnKRF2VVlvIHY0x02scQQu990zSn08l7n+c5pZRfu932+vjvZIy/4zi+ROoq+x/1tz8DwauuSbs76dMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Name and VLAN ID\"\n        title=\"Name and VLAN ID\"\n        src=\"/static/51df9b50d36d0c3c57b5fc7587fe2d6f/64252/33.png\"\n        srcset=\"/static/51df9b50d36d0c3c57b5fc7587fe2d6f/53f68/33.png 213w,\n/static/51df9b50d36d0c3c57b5fc7587fe2d6f/df70d/33.png 425w,\n/static/51df9b50d36d0c3c57b5fc7587fe2d6f/64252/33.png 696w\"\n        sizes=\"(max-width: 696px) 100vw, 696px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>d. Repeat for all other VLANs.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 443px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/02bbbb1e505ec64a787198f0568b8b25/4d697/vmware.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 129.10798122065728%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAIAAAA44esqAAAACXBIWXMAAAsTAAALEwEAmpwYAAADEElEQVQ4y31U25LaRhTk/38mH2BYuxaMCV5XJalKaiFiQUIjpJmRNBfN/eaSMFknWbZLb2d6pk+fo56JYRBCSCmV0kopIUQIId0Q0yuITINOzqduGD/r06zFuCxLMOFyuZzyXEoZQvATUoxaaSmlMa5CAlPjfOyHgFnQNs6ETZemPWRZXhQYY+uscy7e8HTEH1YPu8PzfPPL8/MfFahg0yDUUEqITLMYI6EUItS2rZIq/IQYI1d8/WXddZ020jkXfHDT7d77ENPMhoS7vizLqqq6vieEaGNijKNy589YrDcbQsjYf/zZgREzMpgGYgBAXTeEEGut1vpqYYzxzwoulg/0HtlZwznDGLdtixGq64YxxjkfOLfWxhCfvj71ff82metUVjDLsuPLsa4bY+1o8nQ0hrjJ4IfH+y+nlDjnbdsRQoyx4V+OBWX5r9vN3Ze1SxB1p9PxXJZ103R9r5S+zTkc6mH1ZU3eISPcXeoLhHAYxH/KfzfwYfXpPdmMMYRGyyij46i09t5ba73zwYX3DGM6FaCmlHrntDZKKWt/rIF1fpvV8+XHuy8rpbquvQ6ZEsIYG4aBEMI5Jz3ZgdNq85n092W3bXs+n6WU3ns1aZ4McymmHToslgtK6NtkYRO4wJeXQ5ZlZVkyxs0/6+nDX2f26fPj3fVkfOh70nfduGEYUzoK7rp+Grupabtar+6SnU8NRACUEELOuRTSWWeNMdpYa3tut9uvd92WNp3LGoAyz4uiKAih1oy069FveTVfPtB3DNNmDKAxiaQSUlA6Gn6NhBDCfr/nnL9NthOug3XeO+evhRBfoWzSLvmQpBljzPsbGcIGAFCWoCzPAIDTKVdKXWMkxjhe6iLADlFvXWpoBG1UJt6WxKWqhgjCKUGlEMJMDe8ubPvbt/ycb35fHE/7vmsJIYx0SgmubmQuNERjEiglxwwYhmsB9Hyx/FiAoqj3CKNhEJxzxrkQStub7BACRjDPc865MVprHeKY2ztczB/ntH97t17dHnNr+oevfU4pEJniNaqddTH9sO3/5O+Uf9Ixld6wnwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"vSwitch Port ID\"\n        title=\"vSwitch Port ID\"\n        src=\"/static/02bbbb1e505ec64a787198f0568b8b25/4d697/vmware.png\"\n        srcset=\"/static/02bbbb1e505ec64a787198f0568b8b25/53f68/vmware.png 213w,\n/static/02bbbb1e505ec64a787198f0568b8b25/df70d/vmware.png 425w,\n/static/02bbbb1e505ec64a787198f0568b8b25/4d697/vmware.png 443w\"\n        sizes=\"(max-width: 443px) 100vw, 443px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>You can now assign Virtual Machines to different VLANs by changing their Network Connection/Network Label from LAN to your specified VLAN.</p>\n<p><strong>8.</strong> Now to activate VLAN access on your Switch from your virtualised pfSense. Log into your managed switch and browse to the 802.1Q or VLAN section.</p>\n<p>Create a new VLAN matching your current VLAN settings.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 647px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/72bb6be34c62169bf43d32b3c2802546/f9e62/14.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.779342723004692%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsUlEQVQI12XI3QqCMBjGce+f6tSg6MOae50dyOZmMG+gpqbHQlAHYX5sXkJodFD9+cEDj/WonnXb1W3XaN1pfb3dq7Zr+74x5q02ptamMf0fY02ms/XWoYxiABfDYrna7PZAfNcj2PMRAPg+JgSB5yCMMOwxIIDxP1i2PY9jmV9yKWUQBJzzkDFG6WBYGjIWCT4Uhpxz8XGMIktwoZQqy7IoCqVUlmVplv44f3caS5LkBSNXuFNYmZBvAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Switch VLAN Config\"\n        title=\"Switch VLAN Config\"\n        src=\"/static/72bb6be34c62169bf43d32b3c2802546/f9e62/14.png\"\n        srcset=\"/static/72bb6be34c62169bf43d32b3c2802546/53f68/14.png 213w,\n/static/72bb6be34c62169bf43d32b3c2802546/df70d/14.png 425w,\n/static/72bb6be34c62169bf43d32b3c2802546/f9e62/14.png 647w\"\n        sizes=\"(max-width: 647px) 100vw, 647px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Depending on your switch, you may have the terms '<em>Untagged</em>' and '<em>Tagged</em>' or '<em>Access</em>' and '<em>Trunk</em>'. Cisco brand switches will use '<em>Access</em>' and '<em>Trunk</em>' while other vendors stick to the '<em>Untagged</em>' and '<em>Tagged</em>' convention. To make it easier to remember:</p>\n<ul>\n<li>Untagged = Access</li>\n<li>Tagged = Trunk</li>\n</ul>\n<p><em>Untagged</em> ports should be ports you wish to provide access to that particular VLAN.</p>\n<p><em>Tagged</em> Ports are ports which provide Untagged ports with access to those VLANs. They are an uplink to your pfSense/ESXi box.</p>\n<p>In my scenario, my ESXi box (which contains by pfSense virtual machine) are connected to port number 1 on my switch. This port is therefore capable of every single VLAN (All (4096) as we specified in VMware earlier). Ports 2 to 8 will now be assigned with VLAN 10 when they are passed from the switch to pfSense.</p>\n<p>Configure all other VLAN ports as necessary.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 850px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5e57e3ab99d02042b8c47c0e94658ba3/cf75f/10.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABsUlEQVQY0zXL30tTUQDA8fuvSPQQCL31P/RcGomspz2UUYgQ1UO6fpFWbEQLRLSNWlts2rrnnJ1z77Vz7z3VdtvmhmwqM73eH97p1a05YaVbbYHgl+/rh7s7Kz2JsatT6NKkMBbWnn0qviGlAFx+EMuPzKSH/PTiBH/hZvjcNX/f0OSZ4ednPS/PewP93mDf8Avu1ms4GoTXXyFvIHV7evFeSPZF1PF3yv2QfOetPDZLbwQFz9TnwYfRy773A77IwKOo5+mHEX/syuMoZ5hWq9VqH7drB4dJlp/j5YiQDiMWAkpCLcx/LSa/L/OZEtDKQFs5vYyzZfBjlcuV7GJl/1+n3fx9tGI6uu0YO67p7hlV16jublXdaqPp1BvbtV9OvWHv1czdfXPH/ambFcvhNnRrc8v+2+kctP6UdQsTIclDLEgQE8qYzBjEGIuSzBgWRYDQl0UKERJFqbS+yTWbh72TTrANobQwv0AIAQAk4on4xzgAACEEAYQQUkoz6QxjLJvNrukG1+v1ut3uKd4m+BvgoaIoiqoQTFIopaoqpbIoiJRSTdMK+UIulyssLVUM6z+o8jNltxki8QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"DLink Switch\"\n        title=\"DLink Switch\"\n        src=\"/static/5e57e3ab99d02042b8c47c0e94658ba3/d6170/10.png\"\n        srcset=\"/static/5e57e3ab99d02042b8c47c0e94658ba3/53f68/10.png 213w,\n/static/5e57e3ab99d02042b8c47c0e94658ba3/df70d/10.png 425w,\n/static/5e57e3ab99d02042b8c47c0e94658ba3/d6170/10.png 850w,\n/static/5e57e3ab99d02042b8c47c0e94658ba3/cf75f/10.png 1078w\"\n        sizes=\"(max-width: 850px) 100vw, 850px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>If a DHCP is configured on each VLAN through pfSense, you should be able to acquire an IP address with matching DHCP range when you plug a device into that port.</p>\n<p>Now that our virtual switch and physical switch have been configured for VLANs you can take a rest. If you want to go a few steps further, try separating VLAN access from one another in pfSense or try connecting wireless access points to your network, don't worry if you can't, I'll help out with that in the future :smile:</p>","timeToRead":6,"excerpt":"My current set-up has pfSense vitualised on an all-in-one ESXi host providing networking to my entire infrastructure. This infrastructure is…","fileAbsolutePath":"/home/runner/work/calvin.me/calvin.me/master/posts/2014/2014-09-14-vlan-pfsense/index.md","frontmatter":{"title":"VLAN on VMware, pfSense and a Switch","categories":["Networking"],"tags":["pfsense","vlan","vmware"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#080808","images":{"fallback":{"src":"/static/e3eb5e9ffad700a21542ac85b6aa4ce3/ccc8a/thumbnail.png","srcSet":"/static/e3eb5e9ffad700a21542ac85b6aa4ce3/ccc8a/thumbnail.png 150w,\n/static/e3eb5e9ffad700a21542ac85b6aa4ce3/67d4a/thumbnail.png 300w","sizes":"150px"},"sources":[{"srcSet":"/static/e3eb5e9ffad700a21542ac85b6aa4ce3/3554d/thumbnail.webp 150w,\n/static/e3eb5e9ffad700a21542ac85b6aa4ce3/c437f/thumbnail.webp 300w","type":"image/webp","sizes":"150px"}]},"width":150,"height":150}}}}}},"pageContext":{"filter":"/^.*\\/\\d{4}-\\d{2}-\\d{2}-vlan-pfsense\\/.*$/"}},"staticQueryHashes":[]}