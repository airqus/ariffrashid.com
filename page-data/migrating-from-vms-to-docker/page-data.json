{"componentChunkName":"component---src-templates-post-js","path":"/migrating-from-vms-to-docker","result":{"data":{"markdownRemark":{"html":"<p>My journey from VMware ESXi to purely Docker.</p>\n<!-- more -->\n<h2 id=\"setup-1---2014-vmware-esxi-vms\" style=\"position:relative;\"><a href=\"#setup-1---2014-vmware-esxi-vms\" aria-label=\"setup 1   2014 vmware esxi vms permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup 1 - 2014: VMware ESXi VMs</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 850px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6ce04e798b4a05cc5e3e9c3a472563d0/399e3/v1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.1924882629108%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACt0lEQVQoz0WM3U9ScRjHf130D7hcddHGSiUhziElm4qmpmhLkfD1HDW28oVjoLN54Roqs625uumiLgQyVORlnjVdF71emMcQX+IQvhRGKC6jS44FLl94GubmxWffPd/n8zyo2Ci7W2yUqQsNBVSxsYgqNsk0MqNM9eNhKhnt52t/96dQfx4kUVv9qdTuoxTNbOd5IpmPqzJwTJMmElFxJDhOpWOYVoJhySjTKoOSF1VAvmqG8ok6kNquQbatJBJ6Ivi19zgJ/przYMd6HbYHMgCeJsOcLjWUyMe3hWliKCqXw9WyUhBK0iEZw4AvxlWoi5Iu3muRTurV+dM66grTReW4uqic8c8qkdXfIJjzNYimfKqL076bIiagEs5OVVywNvLFE+0CzNWJpTOduITRCsVTWgE+rxWKC9EyTwT+zMLdVUku+PDsmA/LAm/i2U1nAs83L7gMnixZjE3PBfZSQWyOLwHXCd7XpTPnQv6cAviWnR9bzZDC97yi/SUeH7yneATquaFe15MdCz1kh6enWsv2Vt5Z7lY0v9PLmyb6KltX7pMdbj3R7umr1rB9FdSyXt40ritreq+vblvqre1gdVVtbG+Vxt0tb/miK20sQci4DsgQ2Do59jN6bHgjggYC+8gU9CPThgcZ1mJoMBg5TYei6FkwggzrMWQKssgUDKCBwN7xkY1ogmMzigxrkYM/pvVqpDTb1pRm23y9xcHWDNvdiud2b83Q6CQ5NPJGMWhZrDRb3PUWKxvP+EwOj7yuGRr9oDDbvbUjdnedxeFWmm2flGbbitJsK0HgVAA4FTvwsRzAGUfxn5kKAE9rDNhWgIVbAO5mAFYdA6fyyIn7B3eK/cOOQGGGeBtmCAfHEHT4EI6ppTmGpDnnbZpztdDcTCPNudQ0N9NMc4f7I/cgx8IM8TLMENJ/uiqUOq3HZV8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"v1.png\"\n        title=\"v1.png\"\n        src=\"/static/6ce04e798b4a05cc5e3e9c3a472563d0/d6170/v1.png\"\n        srcset=\"/static/6ce04e798b4a05cc5e3e9c3a472563d0/53f68/v1.png 213w,\n/static/6ce04e798b4a05cc5e3e9c3a472563d0/df70d/v1.png 425w,\n/static/6ce04e798b4a05cc5e3e9c3a472563d0/d6170/v1.png 850w,\n/static/6ce04e798b4a05cc5e3e9c3a472563d0/12c14/v1.png 1275w,\n/static/6ce04e798b4a05cc5e3e9c3a472563d0/399e3/v1.png 1620w\"\n        sizes=\"(max-width: 850px) 100vw, 850px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>When I first started my homelab 5 years ago, I went with <a href=\"https://www.vmware.com/au/products/esxi-and-esx.html\">VMware ESXi</a> as my hypervisor and a slew of <a href=\"https://ubuntu.com/\">Ubuntu</a>/<a href=\"https://www.centos.org/\">CentOS</a> virtual machines because that's what I had learnt from my <a href=\"https://www.ibm.com/au-en/employment/internship.html\">internship at IBM</a>. This, combined with <a href=\"https://en.wikipedia.org/wiki/Virtual_LAN\">VLANs</a> for network separation gave me a complete virtualisation environment where I could do whatever I wanted without comprising any service.</p>\n<p>The <em>benefits</em> of this setup were:</p>\n<ul>\n<li><a href=\"https://kb.vmware.com/s/article/1015180#Whatisasnapshot\">Virtual machine snapshots</a> for quick rollbacks and testing</li>\n<li>Resize/stop/start virtual machines whenever a particular application was needed</li>\n<li>Each application ran in its own virtualised server so it didn't need to contend with others for resources</li>\n</ul>\n<p>The <em>downsides</em> of this setup were:</p>\n<ul>\n<li>Installing the OS, installing packages, setting up SSH, setting up networking and other things whenever I set up a new virtual machine</li>\n<li>I had to test each piece of software individually for how much memory and disk space was necessary, then delete it all do a proper build from scratch</li>\n<li>Always running out of RAM as I was limited to 32GB</li>\n</ul>\n<h2 id=\"setup-2---2017-vmware-esxi-vms-with-docker\" style=\"position:relative;\"><a href=\"#setup-2---2017-vmware-esxi-vms-with-docker\" aria-label=\"setup 2   2017 vmware esxi vms with docker permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup 2 - 2017: VMware ESXi VMs with Docker</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 850px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/15d890f2b02501814ff4960938431097/b1bc2/v2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 105.1643192488263%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFXUlEQVQ4y0WRa0xTZxjHD9r6YX5asuzygSwuApvZuHjB6UKh79v2ALU3bsUrlFqETWfiotFPc8u+LcsiWzIro+e0crEtbBa3uVBaKgdoqdLScygxzjAl04QWJ5UT3bj4LOf0TD88+b/P//393/c9zyEwTb6OKM0+TJNVmCa1iNKoEUXuxjSpkzwdojRCr5Z6JKkK06SQU2KarBZ8RGlyCEyTBkRpANMkCIpoMoMoMiSuX/o3ME1mpHVK9CnNktBjmnz4v1Y4VHICURqdBK5JuogocliC/pU0kPU1K5gmH2CaXEOUJq2k1MLefSWlXldS6vvaboOcUDkrdeUODPXuxrV6934od+BFTJPDKroSWn3tK6RLC2VdKFB7xbxo6qtfJV3aB0d9bWsqujJ9wHsYNM7q+/Xu/c91PaZ54hQhJ9TOKvHARs/B9SMDFlB0oUcqujIg3N42+MmKrscEH/1YHqi90vDI5mtbRZTmYfu148KL0q2+djD11c83eg49t15tnSd2E3JC46zWlXUpofkn67oAlHUpxQOFOZ26fnpF32OCvZ2KwMH+pkft106sCrM6M3RuHdNk+vgvJ8HYWzd/ZMDy/Njgx/PENkJOYLpSJ7xG221Y1XYbQLgZ06RfONDQW/uP2lkFFQ7VcNVlXXpft1GY6V/CpyOKXBBer6Ir71Vd1q1puw33ZOdfkROIJk3C4JWURixMk88wTY4LXgWlBkSJP2VCSWmeST9hqSKrT6V+Ucou6npq5ARy4L3IgccRhUcQhRnkQIPIofwGUTiMKBxADhxROtC3iMLXhF7pQAMi60A+TOFx5EAeROEQorBX0VUuI6wRrtQa4X6zRjjf0Qjnaw6zg5ZwVq0R7qo1wv1ujXBfWSNcd0uE+1VgWsLcYHOY9TVNvGCEvMMa4WRES3S2tiU6C82Ts3A2cRe+TP4J52fm4POZORB8qaas0dn1pskknIrfEZkvZuZE7tit22CZFBm+JTq7ibAxcYWNiXM2JjbVzsRjn04kXtTRG1NTNiY+a2Pil2xj8aCNibFtTCx2Qto/OZGItY6KDGdj4tdtTFxOBPMKlcG8wjvBguKZ4LYdyeH8ouRwfnFyuKA4GXp/10wwr3AumFdIBbYWjgcLiu+8YApKRG5EYPKL/ghuLQwE84vkxNiW92qY3Dy4uVcJnPkwTFcZIE7qYEpZCWxNI4y9sw2Yt9+NMrl5K5GSD0VvutoEiX01EENVkNDXQfiDncDk5mWipWWbCG+xYo+3qCzUv13pHyhV+T27VP6+Hcjfv0Mp1JC3WMF4ixRfe4sUA96S8pGBXdjvLVWLjGcn8vdvrxjylpSHvEWK3v7tFTJCZmdJmZ1dkl1kU7KLidSrXVz6TTqZltvZtOxiYkFmZ3m5nf1ZZmdvy+zs440/JFKbO9n0W85kenMnl96YZTIyOzsts7NyIqcjYcrpSIBQxIUEbKFvwx7vXZB/zwLRwWb9Dm6c6GCfbviOFZk3fpyF3Z678FpnEogL0yDl/87pSGwijC7PHqPLPWJ0uYcMLrdf53T7tU633+Ds8xud3UN6Z2+oqdtxqc7V4zM4e4NGZ4/f4Lrir6bdfr3L7Tde9gwZXe6Q0eXuNbg8MgLCehLC+iUI6xcgrE9lS5eCmwdSELel4dahFEQPPIaoeRFiLSmIWVMwWZdlsvyClJ+GsF5OZJjG2gzTCC9rP2RGG+DJZBssT52G5dhZ4OPnYPnmSVi+9RksT52BJxMtIiOyL7NPMkzjJoJnzLk8Y7byjLmZZ8wWnmmw8GNmC3/DZOFHtBY+pLPwIb2FHzVZ+NE6aV2bZQQ2mxPyDTxj3vAfMpSp2k4YZ9QAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"v2.png\"\n        title=\"v2.png\"\n        src=\"/static/15d890f2b02501814ff4960938431097/d6170/v2.png\"\n        srcset=\"/static/15d890f2b02501814ff4960938431097/53f68/v2.png 213w,\n/static/15d890f2b02501814ff4960938431097/df70d/v2.png 425w,\n/static/15d890f2b02501814ff4960938431097/d6170/v2.png 850w,\n/static/15d890f2b02501814ff4960938431097/b1bc2/v2.png 1125w\"\n        sizes=\"(max-width: 850px) 100vw, 850px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>As I was low of memory, I gave <a href=\"https://www.docker.com/\">Docker</a> a try and was amazed by the reduction in memory usage. Before I knew much about Docker, I assumed a Docker container was another operating system so it would use as much memory as a virtual machine. Docker containers, however, are <a href=\"https://www.docker.com/resources/what-container\">very lightweight and make use of the existing kernel</a>.</p>\n<p>An example of this for running my downloading applications, in <strong>Setup 1</strong> where I ran one server per application:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">VM1 - NZBGet       - RAM: 1GB\nVM2 - Sonarr       - RAM: 2GB\nVM3 - Radarr       - RAM: 2GB\nVM4 - Transmission - RAM: 1GB\nVM5 - NZBHydra     - RAM: 2GB\nVM6 - jDownloader  - RAM: 2GB\n\nTotal - 10GB RAM</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>But in <strong>Setup 2</strong>, I was able to combine common applications or applications that communicated with each other:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">VM1: Docker (NZBGet, Sonarr, Radarr, Transmission, NZBHydra, jDownloader)\nRAM: 8GB</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>This saw a 2GB drop in RAM usage. Not much, but this is just one example! Other services I combined in Docker pushed those RAM savings further while keeping the maintainability of the system.</p>\n<p>The <em>benefits</em> of this setup were:</p>\n<ul>\n<li>Lowered RAM use as I was able to combine applications and run them on the same server</li>\n<li>Better maintainability through Docker instead of installing directly to the server</li>\n<li>Each VM was still network separated from others with VLANs</li>\n</ul>\n<p>The <em>downsides</em> of this setup were:</p>\n<ul>\n<li>Still had to create a virtual machine each time I wanted a new service. This meant installing the OS, installing packages, setting up SSH, setting up network etc. all over again</li>\n<li>Was still tinkering with virtual machine sizing</li>\n</ul>\n<h2 id=\"setup-3---2019-docker-only\" style=\"position:relative;\"><a href=\"#setup-3---2019-docker-only\" aria-label=\"setup 3   2019 docker only permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup 3 - 2019: Docker only</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 639px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/47506338d4013ed9e943bbae69aae90c/3dbb9/v3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 134.7417840375587%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"v3.png\"\n        title=\"v3.png\"\n        src=\"/static/47506338d4013ed9e943bbae69aae90c/3dbb9/v3.png\"\n        srcset=\"/static/47506338d4013ed9e943bbae69aae90c/53f68/v3.png 213w,\n/static/47506338d4013ed9e943bbae69aae90c/df70d/v3.png 425w,\n/static/47506338d4013ed9e943bbae69aae90c/3dbb9/v3.png 639w\"\n        sizes=\"(max-width: 639px) 100vw, 639px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Considering the downsides of <strong>Setup 1</strong> and <strong>Setup 2</strong>, I decided it was time to go a bit further. There were a few considerations:</p>\n<p>Looking at the transition of <strong>Setup 1</strong> (one application per server) to <strong>Setup 2</strong> (multiple Docker applications per server), I was able to combine multiple Ubuntu servers into one. This removed about 200MB of RAM usage and 400MB of disk space for each Ubuntu host that was removed.</p>\n<p>In <strong>Setup 2</strong> (multiple Docker applications per server), there were still multiple instances of:</p>\n<ul>\n<li>Ubuntu</li>\n<li>Docker</li>\n<li>Virtual machines</li>\n</ul>\n<p>So I thought, why not combine this all together into one to remove the overhead? The above diagram summarises it nicely. I still maintain all the same benefits as before while removing the downsides I previously had.</p>\n<p>To migrate to a Docker only environment however, there were two solutions I had to find an answer for:</p>\n<ul>\n<li><strong>Networking</strong>: maintaining network separation within Docker when running on a single host.</li>\n<li><strong>Windows</strong>: How do I run any Windows applications on a Linux host?</li>\n</ul>\n<h2 id=\"docker-networking-with-vlans\" style=\"position:relative;\"><a href=\"#docker-networking-with-vlans\" aria-label=\"docker networking with vlans permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docker Networking with VLANs</h2>\n<p>The hardest part of all this was to be able to separate Docker container to different networks so they wouldn't be able to communicate with each other, or hosts not on their network. I found a solution that worked on a single network interface and supported VLANs.</p>\n<p>To give some perspective, this was what my previous setup on VMware ESXi looked like. Each port groups would have a VLAN tag:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 850px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/220ecb5abede4cdeec9ce94e8daeb2cc/6e693/vmware-networking.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 117.84037558685445%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"vmware-networking.png\"\n        title=\"vmware-networking.png\"\n        src=\"/static/220ecb5abede4cdeec9ce94e8daeb2cc/d6170/vmware-networking.png\"\n        srcset=\"/static/220ecb5abede4cdeec9ce94e8daeb2cc/53f68/vmware-networking.png 213w,\n/static/220ecb5abede4cdeec9ce94e8daeb2cc/df70d/vmware-networking.png 425w,\n/static/220ecb5abede4cdeec9ce94e8daeb2cc/d6170/vmware-networking.png 850w,\n/static/220ecb5abede4cdeec9ce94e8daeb2cc/12c14/vmware-networking.png 1275w,\n/static/220ecb5abede4cdeec9ce94e8daeb2cc/6e693/vmware-networking.png 1660w\"\n        sizes=\"(max-width: 850px) 100vw, 850px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Playing around with Ubuntu's new network configuration tool <a href=\"https://netplan.io/\">NetPlan</a>, I was able to create multiple VLANs off a single interface <code class=\"language-text\">eno1</code>. I set the default gateway to be <code class=\"language-text\">eno1.10</code>, while the other VLANs did not require an IP address (although you could add one if you like):</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">network</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n  <span class=\"token key atrule\">ethernets</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">eno1</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token key atrule\">vlans</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">eno1.10</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">addresses</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> 192.168.1.3/24\n      <span class=\"token key atrule\">gateway4</span><span class=\"token punctuation\">:</span> 192.168.1.1\n      <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span>\n      <span class=\"token key atrule\">link</span><span class=\"token punctuation\">:</span> eno1\n      <span class=\"token key atrule\">nameservers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">addresses</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> 192.168.1.1\n    <span class=\"token key atrule\">eno1.20</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> <span class=\"token number\">20</span>\n      <span class=\"token key atrule\">link</span><span class=\"token punctuation\">:</span> eno1\n    <span class=\"token key atrule\">eno1.30</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> <span class=\"token number\">30</span>\n      <span class=\"token key atrule\">link</span><span class=\"token punctuation\">:</span> eno1\n    <span class=\"token key atrule\">eno1.40</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> <span class=\"token number\">40</span>\n      <span class=\"token key atrule\">link</span><span class=\"token punctuation\">:</span> eno1</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Then within Docker, I used the <code class=\"language-text\">macvlan</code> network driver to physically connect Docker container to a network interface:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">VLAN: <span class=\"token number\">10</span>\nSubnet: <span class=\"token number\">192.168</span>.1.0/24\nGateway: <span class=\"token number\">192.168</span>.1.1\nParent: eno1.10\nDNS: <span class=\"token number\">192.168</span>.1.1\n\n$ docker network create <span class=\"token punctuation\">\\</span>\n  -d macvlan <span class=\"token punctuation\">\\</span>\n  --subnet<span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.1.0/24 <span class=\"token punctuation\">\\</span>\n  --gateway<span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.1.1 <span class=\"token punctuation\">\\</span>\n  -o <span class=\"token assign-left variable\">parent</span><span class=\"token operator\">=</span>eno1.10 <span class=\"token punctuation\">\\</span>\n  --ip-range<span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.1.128/26 <span class=\"token punctuation\">\\</span>\n  mgmt</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Now I have a network called <code class=\"language-text\">mgmt</code> which is connected to <code class=\"language-text\">eno1.10</code>. Sadly any containers on the network won't use DHCP so you will have to provide an <code class=\"language-text\">ip-range</code> for Docker to use. It doesn't care if there's something in that range so be careful.</p>\n<p>To create a Docker container on that network:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">docker run --rm --network mgmt busybox <span class=\"token function\">sh</span> -c <span class=\"token string\">\"ping 192.168.1.1\"</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>To enable DNS however, you will have to specify it with <code class=\"language-text\">--dns</code> or it will use the host computer's DNS which may be inaccessible if the container is on a different network:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\"><span class=\"token comment\"># --dns x.x.x.x</span>\ndocker run --rm --network mgmt --dns <span class=\"token number\">192.168</span>.1.1 busybox <span class=\"token function\">sh</span> -c <span class=\"token string\">\"ping calvin.me\"</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>To set an IP address, provide the <code class=\"language-text\">--ip</code> option:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\"><span class=\"token comment\"># test we can't ping other VLAN networks</span>\ndocker run --rm --network mgmt --ip <span class=\"token number\">192.168</span>.1.20 busybox <span class=\"token function\">sh</span> -c <span class=\"token string\">\"ping 192.168.2.5\"</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>So that now solves our networking so be exactly like before. Each Docker network corresponds to a real network and each container is physically separated from other containers within the same host. Here's a diagram of it:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 850px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d0c56369162324935bb48683bfbdae76/2573e/docker-networking.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 120.18779342723005%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"docker-networking.png\"\n        title=\"docker-networking.png\"\n        src=\"/static/d0c56369162324935bb48683bfbdae76/d6170/docker-networking.png\"\n        srcset=\"/static/d0c56369162324935bb48683bfbdae76/53f68/docker-networking.png 213w,\n/static/d0c56369162324935bb48683bfbdae76/df70d/docker-networking.png 425w,\n/static/d0c56369162324935bb48683bfbdae76/d6170/docker-networking.png 850w,\n/static/d0c56369162324935bb48683bfbdae76/12c14/docker-networking.png 1275w,\n/static/d0c56369162324935bb48683bfbdae76/2573e/docker-networking.png 1380w\"\n        sizes=\"(max-width: 850px) 100vw, 850px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"running-windows-applications\" style=\"position:relative;\"><a href=\"#running-windows-applications\" aria-label=\"running windows applications permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Running Windows Applications</h2>\n<p>Short answer is <em>don't...</em></p>\n<p>Longer answer is there are two options:</p>\n<ol>\n<li>Run a headless virtual machine inside the host (thought we could escape them?). <a href=\"https://help.ubuntu.com/community/KVM/Installation\">Ubuntu provide decent docs</a> for KVM/QEMU and with an <a href=\"https://mobaxterm.mobatek.net/\">X11 Server</a> you can always get a GUI through <a href=\"https://virt-manager.org/\">virt-manager</a>. Combine this with bridging and you should get network separation.</li>\n<li>Find a hacky solution. <em>Read on.</em></li>\n</ol>\n<p>I've gone with option 2 to run <a href=\"https://blueirissoftware.com/\">Blue Iris</a>, my video surveillance software. <a href=\"https://hub.docker.com/r/jshridha/blueiris\">jshridha</a> has created a Docker image that runs Blue Iris on top of <a href=\"https://www.winehq.org/\">Wine</a>.</p>\n<p>So Wine in Docker on Linux...a recipe for disaster.</p>\n<h2 id=\"final-result\" style=\"position:relative;\"><a href=\"#final-result\" aria-label=\"final result permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Final Result</h2>\n<p>Here are stats of the homelab as of right now, running everything I have in the past:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Load average: 1.48, 1.31, 1.16\nMemory: 5.59G/31.4G\nSwap: 2.31G/8.00G\n\nRunning Docker containers: 28</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>An incredible result when considering I was previously running out of memory, to now not even using half of it.</p>\n<p>Now a final benefits and downsides:</p>\n<p><em>Benefits</em>:</p>\n<ul>\n<li>Considerably less memory use</li>\n<li>Quick to spin up and delete a new application (e.g. <code class=\"language-text\">docker run --network mgmt --dns 192.168.1.1 nextcloud</code>) as I no longer need to install Ubuntu, configure networking and everything else that comes with building a new host</li>\n<li>No more virtual machine sizing guessing games</li>\n<li>Direct access to hardware, meaning hardware acceleration!</li>\n</ul>\n<p><em>Downsides</em>:</p>\n<ul>\n<li>No more snapshots, everything should be isolated in a Docker container at which is halfway there.</li>\n<li>Have to manually allocate IP addresses and DNS as no DHCP</li>\n</ul>\n<h2 id=\"future\" style=\"position:relative;\"><a href=\"#future\" aria-label=\"future permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Future</h2>\n<p>Seeing that I made a big change every 2-3 years, this is my guess:</p>\n<ul>\n<li><a href=\"https://kubernetes.io/\">Kubernetes</a>? Perhaps too complicated for this setup and will require new solutions to networking and storage. However, K8S may become simpler in the future (see <a href=\"https://github.com/rancher/k3s\">k3s</a> for example)</li>\n<li>A lighter operating system than Ubuntu like <a href=\"https://coreos.com/\">CoreOS</a> or <a href=\"https://github.com/rancher/os\">RancherOS</a> but then I would have to figure out networking again and if it works with Ansible.</li>\n<li>What if every application becomes a <a href=\"https://serverless.com/\">serverless application</a>?</li>\n</ul>","timeToRead":8,"excerpt":"My journey from VMware ESXi to purely Docker. Setup 1 - 2014: VMware ESXi VMs  When I first started my homelab 5 years ago, I went withâ€¦","fileAbsolutePath":"/home/runner/work/calvin.me/calvin.me/master/posts/2019/2019-12-24-migrating-from-vms-to-docker/index.md","frontmatter":{"title":"Migrating from VMs to Docker","categories":["Networking","Virtualisation"],"tags":["docker","vmware","vlans"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/4ece3515b450a72ae1b32c3cf5b38cc4/ccc8a/thumbnail.png","srcSet":"/static/4ece3515b450a72ae1b32c3cf5b38cc4/ccc8a/thumbnail.png 150w,\n/static/4ece3515b450a72ae1b32c3cf5b38cc4/67d4a/thumbnail.png 300w","sizes":"150px"},"sources":[{"srcSet":"/static/4ece3515b450a72ae1b32c3cf5b38cc4/3554d/thumbnail.webp 150w,\n/static/4ece3515b450a72ae1b32c3cf5b38cc4/c437f/thumbnail.webp 300w","type":"image/webp","sizes":"150px"}]},"width":150,"height":150}}}}}},"pageContext":{"filter":"/^.*\\/\\d{4}-\\d{2}-\\d{2}-migrating-from-vms-to-docker\\/.*$/"}},"staticQueryHashes":[]}