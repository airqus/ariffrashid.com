{"componentChunkName":"component---src-templates-post-js","path":"/nginx-ldap-http-authentication","result":{"data":{"markdownRemark":{"html":"<p>I expose a few of my web services over the Internet like <a href=\"http://sabnzbd.org/\">SABnzbd</a>, <a href=\"https://couchpota.to/\">CouchPotato</a> and NZBDrone (now known as <a href=\"https://sonarr.tv/\">Sonarr</a>). Whilst they all have HTTP authentication, they don't support multiple users. LDAP or Active Directory holds multiple user accounts, for authentication purpose. So putting two and two together, <a href=\"https://github.com/kvspb\">kvsp</a> has made a <a href=\"https://github.com/kvspb/nginx-auth-ldap\">NGINX LDAP module</a> which authenticates users against your LDAP or Active Directory servers when they visit specific web pages.</p>\n<!-- more -->\n<p>To use the NGINX LDAP module, NGINX must be built from source with the module included. For this post, I will be using a fresh install of using Ubuntu 14.04.1 LTS.</p>\n<h2 id=\"download-the-nginx-source\" style=\"position:relative;\"><a href=\"#download-the-nginx-source\" aria-label=\"download the nginx source permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Download the NGINX source</h2>\n<p>First thing's first, download the <a href=\"http://nginx.org/download/\">NGINX source here</a>, the .tar.gz files are for Linux and the .zip files are for Windows. The version depends on you, but I picked the highest 'mainline' version. This is what NGINX has to say about the differences between 'stable' and 'mainline'</p>\n<p>The mainline branch gets new features and bugfixes sooner but might introduce new bugs as well. Critical bugfixes are backported to the stable branch.In general, the stable release is recommended, but the mainline release is typically quite stable as well.More light reading can be found on the <a href=\"http://wiki.nginx.org/Faq#Is_it_safe_to_use_the_development_branch_in_production.3F\">NGINX FAQ</a>. At this time of writing, I've download <a href=\"http://nginx.org/download/nginx-1.7.7.tar.gz\">NGINX 1.7.7</a>.</p>\n<h2 id=\"download-the-nginx-ldap-module\" style=\"position:relative;\"><a href=\"#download-the-nginx-ldap-module\" aria-label=\"download the nginx ldap module permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Download the NGINX LDAP module</h2>\n<p>The module can be found on <a href=\"https://github.com/kvspb/nginx-auth-ldap\">GitHub</a>. I recommend doing a git clone to make updates easier. If you're new to git, you may prefer to <a href=\"https://github.com/kvspb/nginx-auth-ldap/archive/master.zip\">download the module it as is</a>. Unzip if you have to and place it somewhere you'll remember as well.</p>\n<p>To download the module using git, first install git:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token output\">sudo apt-get install git-core</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Clone the repository:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token output\">git clone https://github.com/kvspb/nginx-auth-ldap.git</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Later on if you need to update the module, browse into its folder and run the command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token output\">git pull</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Download the tools and pre-requisites</p>\n<p>There are quite a few things that need to be installed for Ubuntu to be able to build NGINX.</p>\n<p>You will definitely need build tools. Build Essential will cover most:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token output\">sudo apt-get install build-essential</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Something important that's required is the LDAP development library which allows the module to connect to an LDAP server:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token output\">sudo apt-get install libldap2-dev</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>If you're planning on using HTTPS/SSL you will also need the OpenSSL library:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token output\">sudo apt-get install libssl-dev</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>If you also plan on using HTTP rewrites then you will need the PCRE library. HTTP rewrites are used for URL manipulation.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token output\">sudo apt-get install libpcre3-dev</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h2 id=\"build-nginx\" style=\"position:relative;\"><a href=\"#build-nginx\" aria-label=\"build nginx permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Build NGINX</h2>\n<p>Untar the NGINX source you have downloaded:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token output\">tar -xvzf nginx-1.7.7.tar.gz</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Browse into the source folder:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token output\">cd nginx-1.7.7</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>I've found on Ubuntu (but not CentOS), the configure file is not executable. To make it executable:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token output\">chmod +x configure</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Now you will need to configure your environment for building. I ran into a few problems at the beginning as I forgot a lot of additional modules which come standard in Linux package managers like SSL (HTTPS), IPv6 and even logging. Another disadvantage are the file paths differ from a package manager installation as well as the 'sites-enabled' and 'sites-available' folder structure. I tried my best to make identical to a package manager installation as I could. This is my personal configure script:</p>\n<p>note: please change the path of the NGINX LDAP module in the command below if it differs from mine ( --add-module=/home/$USER/nginx-auth-ldap).</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token output\">./configure --user=nginx --group=nginx --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --conf-path=/etc/nginx/nginx.conf --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --with-http_gzip_static_module --with-http_stub_status_module --with-http_ssl_module --with-pcre --with-file-aio --with-http_realip_module --add-module=/home/$USER/nginx-auth-ldap/ --with-ipv6 --with-debug</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>If it does not run successfully then there are some dependencies missing. Looking through the output and reading the error messages can determine which specific libraries are missing. The successful output will look like:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 549px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cd0ee52582b94cd6aef3fdb6c5c624c6/ffc28/untitled.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.68544600938967%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABhklEQVQoz4WRW3ObMBBGbUztQAsSEhKg2+qCkAhMEv//P5fBzUs6bX1mH/fs7nx7EkKEAw/Wppy317UjBHddVVWnp7xUFQAIIbxz1lofZmutc15r/XK7PZHbts15VVKt6+u27R/vH1rrJUbnXFEUT+SqqgihrO8ZZ4wzhBDGHWM9Qui5zIfBwIFSwhhDe9ozBgBxWZRSuOt+lOU/5WGcvPfjOK05h3k2YKRSWitK6TEiRmMMxvh2vdU/6/P5yzo/6mQMbNsWgk/L4vyBsw7A5pxTXt/f3qZx5JxT2lNK/9wshJzjEuOstPY+WLAA1nsHAN77fd/TksI8hzCDMeJBVdV1XTfNrxPj3ABYa6UUYC3jQ0pZKSml/N1trVVaA0DTNE3btG2LEH7kik5K65TWGI/3btvmfLjf7yktWus4R86Y837b95zXcRwul8u3s3vGlNJCTJzzcRyFkMGHgTPOB8YYIXSahFKaEvKXtDHGhJCyLI8Az+eiKBBCXdddr1eM8TTJ//z5E4oiMePHLJ69AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"configure finished\"\n        title=\"configure finished\"\n        src=\"/static/cd0ee52582b94cd6aef3fdb6c5c624c6/ffc28/untitled.png\"\n        srcset=\"/static/cd0ee52582b94cd6aef3fdb6c5c624c6/53f68/untitled.png 213w,\n/static/cd0ee52582b94cd6aef3fdb6c5c624c6/df70d/untitled.png 425w,\n/static/cd0ee52582b94cd6aef3fdb6c5c624c6/ffc28/untitled.png 549w\"\n        sizes=\"(max-width: 549px) 100vw, 549px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Once it runs successfully (thumbs crossed) it's time to build the system. Just this command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token output\">make</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 567px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7296a3911ba4192d025e4216b6fae2ae/b546d/Capture.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.92488262910798%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAABCElEQVQY023Oy26EIACFYbQDaAEVGETRtHIZhMrEtu//cI1dddFvcXYn+QEAAFSVc+FZyp7ScRzeez2Oo9bjqJVSQshrpbzf5fiLEPLathBCEEKQQphlLc+nc87ZLcY4TbNzzsxmNmZZFj1NgnPWdRhjSilCqG1bhBA4z9PMs3X+PM+csnfW+7DZbdRaCkEpGy49xg2EsK5r8Fff902DOedKKa11COEoJcb96ndWyqvZmEUpxTlnjN5uN/AvhLHW+vPruxzF+/CR8+MRgw8+hJSStc5u71JK1nWUkJe6BsMwEEKapqWUKnWPMaaU13V927b9EVPO+75fB8a6vsMYQQgxbhBCVVX9ACUsHdOBwGVLAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"make finished\"\n        title=\"make finished\"\n        src=\"/static/7296a3911ba4192d025e4216b6fae2ae/b546d/Capture.png\"\n        srcset=\"/static/7296a3911ba4192d025e4216b6fae2ae/53f68/Capture.png 213w,\n/static/7296a3911ba4192d025e4216b6fae2ae/df70d/Capture.png 425w,\n/static/7296a3911ba4192d025e4216b6fae2ae/b546d/Capture.png 567w\"\n        sizes=\"(max-width: 567px) 100vw, 567px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>To finish it off, install NGINX with all the paths and modules we've specified.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token output\">sudo make install</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 423px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c710768338de921d8ea7badd3f73f5c5/6fe3b/Untitled1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAADL0lEQVQ4y21TyZLbOAxl2522JdlaSIqbSIk7JUqyO8ekpvL/nzUldyqZw+DAQoEkHvAeAOYUhRjmOTnnrHM557wkjPE0Td55NQxVVSGECOkZ49ZaxijueyklQhD8+vWPnqa+xyHEnNdt31OKetIxxpSSEAJC2Pd9fa/rur7fbxDCpmmK4lqUJfj++V1wTgilTMwxGm3Wde26FmPsQziuKFVS5XXNy7zkNfhQ3+9FUdxuN7DtD4zQ/V4jhI3WzodlWarqdrvd6nt9Op3O53NZlnKQX4kIOYBGpUKMIMaopGKMyWFQ40gpdd6HELZ9d9YNgyiuxdvbG3jZ5XJt2/Z6vbRtWzctyDkzypRSxtjgg1JqWRYEYVmWB3h9//j2rbrd1KikHIqyvF6vlFII0TiOwBrDmNjWNYQwjpOUsifEGjvPyzwv9b0CALy97Ms5nU5/fOC951yEELTWRmvGGKXMO59zTnHu2gb8n53P5/f3d7AsmfSEMTYZE4L3PqYYlRqfz8c0mc/Pz0Onui6rCkJYvU6Mcd/3bduBeZ4JocMwWOfDQVWMMQzDELzXWsd4BJ7Pzw5CxljTNBhjzvmRsWlA+v1ZKDUuyxy8T2netn0Qoiqr12DUGGMIEUKQMtq2LSFkHJXz/g+yGKdpWRZr7CGeUtba4L3z3jnP2UFvj3FV3RA60jjnYghgXmZKqBBcqTGlZIzJOSulpmkSXEzaxBh7jDsIydHnYRBCLoSx9m/Zxtg5Jef84/GYpvH1rMMY13X9xdNrPUgHIed8kMr/LVsIKWVKBz+Px44gatrmi56mrouiwLg/SCbkKyiljDH+Rhaca63TgezWbRvHKefMuXDOIYTq+72qDvJe8JhSwjnHfQ+W9RjPQyprjbX6aJW9v793XQchJIRghI014RAtEELlMMQYOaNN04DH89n3uG1a3PfptZIxxmnSnLGiuH58fAAATqdTVZbXovDBSzlAhBmj87yAddsxRi8Q6r231j2ezyWvc4pFcb1cLv+dSj2NRuu26xhj276Dnz9/eOfoMdJ0f+zeh3le1rx679mxPTDEpPUkpVJKbtuecxbD0DQt5/xf4C13KKm4frsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sudo make install finished\"\n        title=\"sudo make install finished\"\n        src=\"/static/c710768338de921d8ea7badd3f73f5c5/6fe3b/Untitled1.png\"\n        srcset=\"/static/c710768338de921d8ea7badd3f73f5c5/53f68/Untitled1.png 213w,\n/static/c710768338de921d8ea7badd3f73f5c5/6fe3b/Untitled1.png 423w\"\n        sizes=\"(max-width: 423px) 100vw, 423px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"init-script\" style=\"position:relative;\"><a href=\"#init-script\" aria-label=\"init script permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Init script</h2>\n<p>The initialisation script allows you to execute 'start', 'restart', 'status' and 'stop' commands to NGINX. Jason Giedyman has a <a href=\"https://github.com/JasonGiedymin/nginx-init-ubuntu\">tried and true NGINX init script</a> but I've modified  for my own configuration. You may  alter either if you have changed the paths differently than I have.</p>\n<p>To install the init script:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token output\">sudo wget https://raw.githubusercontent.com/calvinbui/nginx-init-ubuntu/master/nginx -O /etc/init.d/nginx</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Make the file executable:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token output\">sudo chmod +x /etc/init.d/nginx</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Make NGINX startup at boot using upstart</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token output\">sudo update-rc.d -f nginx defaults</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Now you can start NGINX but running:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token output\">sudo service nginx start</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Browse to the host's IP address or FQDN to see the NGINX page:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 511px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/32479f223ccd0ac0f4c1f6ef3e6baeb9/40f84/Capture1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.375586854460096%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABVElEQVQY02VR70vDMBDt/4+Cn53iBxH8NWQTP6jzj7C6ui7pGk1q0lzappG1Tbc1sk2G6OM47g4e7/HOox8fMXnnnGutQcqiKJRSRaGNMVIICZBlmbXWOddtsB3cBt711WWvd3R+cd7v35wcH94Mhk+j0fD2bjAYHuzvnZ6d3T88zufVb84O3u6yWCy6rltt4Jxr27aq6y2nbVtrbVM3VVXXdTOfV03TWGs9QuIX35/F6x4E4yAIgvH42ffDMEQYjV9fEUIgAaSkjDLGBBeEEM45ZMr7MkZK0FrnWV6WpdaFSAUoZcqvstRKpVrnzm0c/bedpgLjKIrQLCZ4OkWTyXrFGCE0eQsxEuGEYkwTxoTgOLLTcEnpYpuAp7UWgisAkJAkSZFnWZ4xlnD+CaqMZytKOwmdc2vZ5fKnfpQVqIQxLlIpU5AyST4JIcaYP/Hu/vTb9jeUY7gPEbDXdQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"nginx landing page\"\n        title=\"nginx landing page\"\n        src=\"/static/32479f223ccd0ac0f4c1f6ef3e6baeb9/40f84/Capture1.png\"\n        srcset=\"/static/32479f223ccd0ac0f4c1f6ef3e6baeb9/53f68/Capture1.png 213w,\n/static/32479f223ccd0ac0f4c1f6ef3e6baeb9/df70d/Capture1.png 425w,\n/static/32479f223ccd0ac0f4c1f6ef3e6baeb9/40f84/Capture1.png 511w\"\n        sizes=\"(max-width: 511px) 100vw, 511px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"optional-package-manager-layout\" style=\"position:relative;\"><a href=\"#optional-package-manager-layout\" aria-label=\"optional package manager layout permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(Optional) Package Manager Layout</h2>\n<p>This is an optional step. The idea is to change the layout to include 'sites-enabled' and 'sites-available'. This is similar to how it would appear when installing NGINX through apt-get. It is a more convenient way of managing virtual hosts but not required.</p>\n<p><a href=\"http://www.rackspace.com/knowledge_center/article/ubuntu-and-debian-nginx-from-source-layout\">Rackspace has a perfectly good guide on this</a> so I'll leave it for them instead. Make sure to change the paths around as necessary to '/etc/nginx/'.</p>\n<h2 id=\"configure-nginx-ldap-module\" style=\"position:relative;\"><a href=\"#configure-nginx-ldap-module\" aria-label=\"configure nginx ldap module permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configure NGINX LDAP Module</h2>\n<p>It's finally time to actually configure the NGINX module we downloaded and built so long ago.</p>\n<p>Open up your nginx.conf file for editing:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token output\">sudo editor /etc/nginx/nginx.conf</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>In here you will define an LDAP server. It is possible to define multiple servers by creating multiple 'ldap_server' blocks. This is what I use to allow all users to login is:</p>\n<div class=\"gatsby-highlight\" data-language=\"nginx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-nginx line-numbers\"><code class=\"language-nginx\">auth_ldap_cache_enabled on<span class=\"token punctuation\">;</span>\nauth_ldap_cache_expiration_time <span class=\"token number\">10000</span><span class=\"token punctuation\">;</span>\nauth_ldap_cache_size <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n\nldap_server adds <span class=\"token punctuation\">{</span>\n    url <span class=\"token string\">\"ldaps://10.0.0.0/dc=home,dc=net?sAMAccountName?sub?\"</span><span class=\"token punctuation\">;</span>\n    binddn <span class=\"token string\">\"homenginx\"</span><span class=\"token punctuation\">;</span>\n    binddn_passwd <span class=\"token string\">\"password\"</span><span class=\"token punctuation\">;</span>\n    require valid_user<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">satisfy</span> any<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># 'adds' will be the module reference</span>\n<span class=\"token comment\"># 'ldaps' as I am using SSL. the other option is 'ldap'</span>\n<span class=\"token comment\"># '10.0.0.0' is my Active Directory IP address</span>\n<span class=\"token comment\"># 'dc=home,dc=net' is my domain (home.net)</span>\n<span class=\"token comment\"># 'homenginx' is my domain user. note the double slash.</span>\n<span class=\"token comment\"># 'password' is my domain user's (nginx) password.</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>So put this into the nginx.conf file, here's mine!</p>\n<div class=\"gatsby-highlight\" data-language=\"nginx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-nginx line-numbers\"><code class=\"language-nginx\"><span class=\"token keyword\">worker_processes</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">events</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">worker_connections</span> <span class=\"token number\">1024</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">http</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">include</span> mime<span class=\"token punctuation\">.</span><span class=\"token keyword\">types</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">default_type</span> application<span class=\"token operator\">/</span>octet<span class=\"token operator\">-</span>stream<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">client_body_timeout</span> <span class=\"token number\">12</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">client_header_timeout</span> <span class=\"token number\">12</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">keepalive_timeout</span> <span class=\"token number\">15</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">send_timeout</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">gzip</span> on<span class=\"token punctuation\">;</span>\n\n    auth_ldap_cache_enabled on<span class=\"token punctuation\">;</span>\n    auth_ldap_cache_expiration_time <span class=\"token number\">10000</span><span class=\"token punctuation\">;</span>\n    auth_ldap_cache_size <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n\n    ldap_server adds <span class=\"token punctuation\">{</span>\n         url <span class=\"token string\">\"ldaps://10.0.0.0/dc=home,dc=net?sAMAccountName?sub?\"</span><span class=\"token punctuation\">;</span>\n         binddn <span class=\"token string\">\"homenginx\"</span><span class=\"token punctuation\">;</span>\n         binddn_passwd <span class=\"token string\">\"password\"</span><span class=\"token punctuation\">;</span>\n         require valid_user<span class=\"token punctuation\">;</span>\n         <span class=\"token keyword\">satisfy</span> any<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">server</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Now that it's in place, you can apply it under different 'location' blocks. You will need an 'auth_ldap' which displays the message to be shown and the 'auth_ldap_servers' which is the server to authenticate against:</p>\n<div class=\"gatsby-highlight\" data-language=\"nginx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-nginx line-numbers\"><code class=\"language-nginx\"><span class=\"token keyword\">location</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\"># message shown when accessing this location</span>\n    auth_ldap <span class=\"token string\">\"Enter AD credentials e.g. 'calvin'\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\"># LDAP block 'adds' I defined earlier</span>\n    auth_ldap_servers adds<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">root</span>   html<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">index</span>  <span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>html <span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>htm<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Restart NGINX when done</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token output\">sudo service nginx restart</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Now access the page again and if successful you will be prompted to login!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 636px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c48b4dc4b98b80229d4aba55257458e9/44bb2/Capture2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.98591549295775%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAABBElEQVQY02WO7W6CMBiFuf8r4Qb4adwmcYB0MgRlfJVWirBMaEu1Lb8WdMuW+OTkSd7knOQ1HMf1HBf4vut5lmWZprlYPi2eV8uX1Xr9uvE2APgAAN+fDQAIgiAMw+17aLu+YYPC3mJ15VEYJYckz7IsTevjEVUIlhBCWFUVwhjCCmOMEJpdobb7ZJwZeQHjODk1DRdioJQOTAihtJbqjla/yL9zNh9HoyEElmVzai/nXt5n8qcrL1cplZ4mrSel9f/oaRJCGG3bMsYoZ/AtyOL97VOY5MU+zeM0T9Osrutz3w+UPsboum4eDwMfR8Y5o5Rzhruv4KM4YIIwjnY7QsjceeAbbhNCT1OPYUYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"nginx ldap prompt\"\n        title=\"nginx ldap prompt\"\n        src=\"/static/c48b4dc4b98b80229d4aba55257458e9/44bb2/Capture2.png\"\n        srcset=\"/static/c48b4dc4b98b80229d4aba55257458e9/53f68/Capture2.png 213w,\n/static/c48b4dc4b98b80229d4aba55257458e9/df70d/Capture2.png 425w,\n/static/c48b4dc4b98b80229d4aba55257458e9/44bb2/Capture2.png 636w\"\n        sizes=\"(max-width: 636px) 100vw, 636px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>We're done! For extra configurations have a read through the <a href=\"https://github.com/kvspb/nginx-auth-ldap\">nginx ldap module</a> documentation.</p>\n<h2 id=\"resources\" style=\"position:relative;\"><a href=\"#resources\" aria-label=\"resources permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Resources</h2>\n<ul>\n<li><a href=\"http://www.rackspace.com/knowledge_center/article/ubuntu-and-debian-installing-nginx-from-source\">http://www.rackspace.com/knowledge_center/article/ubuntu-and-debian-installing-nginx-from-source</a></li>\n<li><a href=\"http://wiki.nginx.org/Install#Building_Nginx_From_Source\">http://wiki.nginx.org/Install#Building_Nginx_From_Source</a></li>\n<li><a href=\"http://demongin.org/\">http://demongin.org/</a></li>\n<li><a href=\"http://www.allgoodbits.org/articles/view/29\">http://www.allgoodbits.org/articles/view/29</a></li>\n<li><a href=\"https://github.com/JasonGiedymin/nginx-init-ubuntu\">https://github.com/JasonGiedymin/nginx-init-ubuntu</a></li>\n<li><a href=\"https://github.com/kvspb/nginx-auth-ldap\">https://github.com/kvspb/nginx-auth-ldap</a></li>\n</ul>","timeToRead":7,"excerpt":"I expose a few of my web services over the Internet like SABnzbd, CouchPotato and NZBDrone (now known as Sonarr). Whilst they all have HTTP…","fileAbsolutePath":"/home/runner/work/calvin.me/calvin.me/master/posts/2014-11-16-nginx-ldap-http-authentication/index.md","frontmatter":{"title":"NGINX LDAP HTTP Authentication","categories":["Networking","Security"],"tags":["active directory","http authentication","ldap","nginx"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#080808","images":{"fallback":{"src":"/static/7842b72dfe18019ba20b0e35dd3016e3/ccc8a/thumbnail.png","srcSet":"/static/7842b72dfe18019ba20b0e35dd3016e3/ccc8a/thumbnail.png 150w,\n/static/7842b72dfe18019ba20b0e35dd3016e3/67d4a/thumbnail.png 300w","sizes":"150px"},"sources":[{"srcSet":"/static/7842b72dfe18019ba20b0e35dd3016e3/3554d/thumbnail.webp 150w,\n/static/7842b72dfe18019ba20b0e35dd3016e3/c437f/thumbnail.webp 300w","type":"image/webp","sizes":"150px"}]},"width":150,"height":150}}}}}},"pageContext":{"filter":"/^.*\\/\\d{4}-\\d{2}-\\d{2}-nginx-ldap-http-authentication\\/.*$/"}},"staticQueryHashes":[]}