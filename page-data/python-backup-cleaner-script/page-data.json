{"componentChunkName":"component---src-templates-post-js","path":"/python-backup-cleaner-script","result":{"data":{"markdownRemark":{"html":"<p>A Python script I've written to clean up old backups, keeping only the newest specified amount.</p>\n<!-- more -->\n<p>As I covered in a <a href=\"/comparison-of-free-esxi-vm-backup-softwares\">previous post</a>, I am currently backing up my VMs using XSIBackup. There is an option in XSIBackup to delete folders older than N days. This option <code class=\"language-text\">--del-dirs</code> however is only available in the Pro version.</p>\n<p>So I've took it upon myself to script it up, using the available Python 3.5 executable in ESXi and XSIBackups' built-in cron functionality.</p>\n<p><a href=\"https://gist.github.com/calvinbui/1954841007c4984769080ec4a12df754\">Find the code on GitHub Gist</a>.</p>\n<h2 id=\"esxi-instructions\" style=\"position:relative;\"><a href=\"#esxi-instructions\" aria-label=\"esxi instructions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ESXi Instructions</h2>\n<ol>\n<li>Copy the script to a datastore</li>\n<li>Edit the xsibackup crontab: <code class=\"language-text\">vi xsi-dir/conf/root-crontab</code></li>\n<li>Add in the script with it's required options. <code class=\"language-text\">-p</code> for path, <code class=\"language-text\">-r</code> for regex and <code class=\"language-text\">-k</code> for how many to keep.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\"># This crontab belongs to the root user, thus it starts by root-\n# Add cron jobs to this file in the classic crond Linux way.\n# This is an example of a backup job being run everyday at 2:00 a.m.\n# change according to your needs and run ./xsibackup --update-cron\n# min hour day mon dow command\n# 0 2 * * * \"/vmfs/volumes/datastore1/xsi-dir/jobs/001\"\n0 4 * * * \"/vmfs/volumes/files/Misc/VMs/xsi-dir/jobs/002\"\n0 6 * * * /bin/python /vmfs/volumes/files/Misc/VMs/clean_backups.py -p '/vmfs/volumes/files/Misc/VMs/' -r 'backup*' -k 5</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ol start=\"4\">\n<li>Install xsibackup's crontab: <code class=\"language-text\">./xsibackup --install-cron</code></li>\n<li>Update xsibackup's crontab: <code class=\"language-text\">./xsibackup --update-cron</code></li>\n<li>Double check ESXI's crontab: <code class=\"language-text\">cat /var/spool/cron/crontabs/root</code></li>\n</ol>","timeToRead":1,"excerpt":"A Python script I've written to clean up old backups, keeping only the newest specified amount. As I covered in a previous post, I amâ€¦","fileAbsolutePath":"/home/runner/work/calvin.me/calvin.me/master/posts/2018/2018-12-14-python-backup-cleaner-script/index.md","frontmatter":{"title":"Python Backup Cleaner Script","categories":["Storage","Virtualisation"],"tags":["python","xsibackup"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#080808","images":{"fallback":{"src":"/static/ca2ceddcd9c28a22c449286f3fe66751/ccc8a/thumbnail.png","srcSet":"/static/ca2ceddcd9c28a22c449286f3fe66751/ccc8a/thumbnail.png 150w,\n/static/ca2ceddcd9c28a22c449286f3fe66751/67d4a/thumbnail.png 300w","sizes":"150px"},"sources":[{"srcSet":"/static/ca2ceddcd9c28a22c449286f3fe66751/3554d/thumbnail.webp 150w,\n/static/ca2ceddcd9c28a22c449286f3fe66751/c437f/thumbnail.webp 300w","type":"image/webp","sizes":"150px"}]},"width":150,"height":150}}}}}},"pageContext":{"filter":"/^.*\\/\\d{4}-\\d{2}-\\d{2}-python-backup-cleaner-script\\/.*$/"}},"staticQueryHashes":[]}