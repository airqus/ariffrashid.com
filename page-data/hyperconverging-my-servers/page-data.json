{"componentChunkName":"component---src-templates-post-js","path":"/hyperconverging-my-servers","result":{"data":{"markdownRemark":{"html":"<p>I merged all my home servers together to improve performance while reducing power usage.</p>\n<!-- more -->\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#preface\">Preface</a></p>\n</li>\n<li>\n<p><a href=\"#adding-more-drives\">Adding more drives</a></p>\n<ul>\n<li><a href=\"#hp-h220-lsi-sas2308\">HP H220 (LSI SAS2308)</a></li>\n<li><a href=\"#3d-printed-pci-drive-mounts\">3D Printed PCI Drive Mounts</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#zfs-on-linux\">ZFS on Linux</a></p>\n<ul>\n<li><a href=\"#importing-the-zfs-zpool-in-linux\">Importing the ZFS ZPool in Linux</a></li>\n<li><a href=\"#setting-up-smb-samba\">Setting up SMB (Samba)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#monitoring\">Monitoring</a></p>\n<ul>\n<li><a href=\"#zfswatcher\">zfswatcher</a></li>\n<li><a href=\"#scrutiny\">scrutiny</a></li>\n<li><a href=\"#zfs-zed\">ZFS ZED</a></li>\n</ul>\n</li>\n</ul>\n</div>\n<h2 id=\"preface\" style=\"position:relative;\"><a href=\"#preface\" aria-label=\"preface permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Preface</h2>\n<p>In one of my first ever posts, I shared my <a href=\"/all-in-one-esxi-server\">all-in-one server</a> which has since been split into a separate application server running pure <a href=\"/migrating-from-vms-to-docker\">Docker containers</a> and a <a href=\"/my-72tb-freenas-server\">72TB FreeNAS storage server</a>.</p>\n<p>There was an imbalance however. The storage server was way more powerful than the application server yet acted as an archive and used infrequently. It didn't need its 128GB of RAM and Intel Xeon E5 CPU for that. If I swapped the hardware out with the application server, the combination of 32GB of RAM and 72TB of raw disks would have made FreeNAS/ZFS unstable. I decided the best action was to combine my application and storage server together.</p>\n<p>The act of merging application, storage and network devices is known as <a href=\"https://en.wikipedia.org/wiki/Hyper-converged_infrastructure\">hyper-converged computing</a> This excellent diagram below from <a href=\"https://www.helixstorm.com/blog/hyperconverged-infrastructure/\">helixstorm</a> outlines the different types of infrastructures possible.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/812ee2fc9a5017578ff6d9f2cbc8b6d0/a24e6/hyperconverge-diagram.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.47887323943662%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIBAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB3B4RC0P/xAAYEAACAwAAAAAAAAAAAAAAAAABQQAQQv/aAAgBAQABBQLTBpz/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAXEAADAQAAAAAAAAAAAAAAAAAAASAx/9oACAEBAAY/AhmOP//EAB4QAAECBwEAAAAAAAAAAAAAAAABERAhMUFRYcHR/9oACAEBAAE/IZ+eiPrH3yFxKof/2gAMAwEAAgADAAAAEEw//8QAFhEBAQEAAAAAAAAAAAAAAAAAABEB/9oACAEDAQE/EImv/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/EGx//8QAHRABAAICAgMAAAAAAAAAAAAAAQARITEQQWGxwf/aAAgBAQABPxAbl0leMPKVAUUYxKHSpabnxPT4/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"hyperconverge diagram\"\n        title=\"hyperconverge diagram\"\n        src=\"/static/812ee2fc9a5017578ff6d9f2cbc8b6d0/a24e6/hyperconverge-diagram.jpg\"\n        srcset=\"/static/812ee2fc9a5017578ff6d9f2cbc8b6d0/08b27/hyperconverge-diagram.jpg 213w,\n/static/812ee2fc9a5017578ff6d9f2cbc8b6d0/6f6b2/hyperconverge-diagram.jpg 425w,\n/static/812ee2fc9a5017578ff6d9f2cbc8b6d0/a24e6/hyperconverge-diagram.jpg 800w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>To achieve this I needed to:</p>\n<ol>\n<li>Get more drives into my already cramped server</li>\n<li>Run ZFS on Linux instead of FreeNAS. Docker containers aren't supported on FreeNAS</li>\n<li>Enable monitoring for ZFS on Linux</li>\n</ol>\n<h2 id=\"adding-more-drives\" style=\"position:relative;\"><a href=\"#adding-more-drives\" aria-label=\"adding more drives permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Adding more drives</h2>\n<p>My <a href=\"http://www.norcotek.com/product/rpc-431/\">Norco RPC-431</a> only supports 9x3.5\" drives and 1x2.5\" drive. I needed to add and extra 1x3.5\" and 2x2.5\" drives used for my security cameras and the operating system. My <a href=\"https://www.supermicro.com/products/motherboard/xeon/c600/X10SRi-F.cfm\">Supermicro X10SRi-F</a> motherboard also has only 10 SATA ports. I had to get a bit creative.</p>\n<h3 id=\"hp-h220-lsi-sas2308\" style=\"position:relative;\"><a href=\"#hp-h220-lsi-sas2308\" aria-label=\"hp h220 lsi sas2308 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>HP H220 (LSI SAS2308)</h3>\n<p>Adding more SATA ports is an easy task with a RAID card running in IT mode. Thanks to the ServeTheHome forums, I was able to go through all <a href=\"https://forums.servethehome.com/index.php?threads/lsi-raid-controller-and-hba-complete-listing-plus-oem-models.599/\">a list of all models</a> and their OEM counterparts.</p>\n<p>I decided I wanted a SAS2308 or newer card as they support SATA3 (6Gb/s) speeds for my SSDs. Searching each one on eBay, I found the HP H220 for around AUD $55.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 850px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/65c1fa407daa2e7fd4947654edab62ae/ef635/hp-h220.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.83098591549296%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAADYUlEQVQozwFWA6n8AJFqIlM3DzUbATofATkfATgeADkfATohAjshAjshAjogATggATkgATohAzsjAzsiAj4kBTwhBVI3DYxoHQD/0E9pTiEwIx9LPTBCNCdKPC9OPzFGNiVOPy5NPi1MPStNPixNPy1DNCFAMBxDMx88KRQtHBBkSR/9zD0A/MNJZ0smbmpoqaimhH95m5mWjYeDhoB5h4J6h4F4h4F3hH90h4F2d3BjbWVWa2JVZl1PbWZcZk4v7LY2AOmwPmxRLn56d8jJy6mopZmYla+vqrW0rri3sri2sKCdmpGNipGNiYV/en13cWhgWnpyZXlvZGNMLtGZKwDqsTtrUTGFfnm3tLCvq6eVlJGXlIyloJemoZaemo+JhH2GgXuFf3h+d3B6cmtrZWJ6b2J3bF9zXEDSnDEA7rQ6Zk8whX10saqhqKOcdHx8f4yLgY6MfYaDcn12Ym9pZHJtc356eIN9aXBrdXlwgHdneGlZdl9F2KQ5AOmwOWJLLntwZaSajKumnWh0dXKDg3SGhWp9fD9KSCUpKB4mKU1WWWyBgVZnZ3t8dYd/bINvV3heQ9mnOwDkrTpfSC13a16jl4igmY9VYF5pdnJmcW1PXlwcLC0QFRkKDhIXHyI6VlFBVFRpbGaJf2qGcFeAZkzYpTwA4ao8WUIodmhaoJGBhoB3SFZQUmFbT1xXRl9bGiwtAwgNBgkOERoYJ0hBLUNBWl5ZcXBefGtRgWdM2KQ+ANumPFZBJ3ZpW6OTg3RwZ0lTTGZlWGx3eE1cTig3LiQsJyEpIkxIPFdcTlRbTE5SRVlbSWlcRIBmTNOgPQDVojxVPyZyYlCYiHZ7bmFvYlKUg26dkIOKfmmIfGeFeWSBdmCXinmaiXaSfWeWgWmeinOVhHODaVPPnDwAzp07VD4ogHJgpZR/koFvjHtnopWFr6OUp5mHmoh1l4Vxmol0nYp2mIZylX9loY10qJmEmINrhWdOy5k9AMyaNVdCJ4p4ZJ6KdpiDbZB8Y5B8ZI57ZY98ZZB8Zo98ZpF+Z5OAapF+ZpR/Z5aBaI51VoRqS3pgRMaVNwD4vDDepjLCkTCoeyeedCeacieWbyeWbimUbCmUaymTayqTaymSaieTaiWVayaVaiOabSOmdyLCjh/kqCGjm1xJ4Mxm3wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"hp h220\"\n        title=\"hp h220\"\n        src=\"/static/65c1fa407daa2e7fd4947654edab62ae/d6170/hp-h220.png\"\n        srcset=\"/static/65c1fa407daa2e7fd4947654edab62ae/53f68/hp-h220.png 213w,\n/static/65c1fa407daa2e7fd4947654edab62ae/df70d/hp-h220.png 425w,\n/static/65c1fa407daa2e7fd4947654edab62ae/d6170/hp-h220.png 850w,\n/static/65c1fa407daa2e7fd4947654edab62ae/12c14/hp-h220.png 1275w,\n/static/65c1fa407daa2e7fd4947654edab62ae/ef635/hp-h220.png 1391w\"\n        sizes=\"(max-width: 850px) 100vw, 850px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>I also grabbed two cables mini-SAS (SFF-8087) to SATA cables from AliExpress for around AUD $8.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 850px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1848da3866f6c647d92c7a8d7eb88637/43dd6/sas-to-sata.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.40375586854461%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAACWklEQVQoz41Tz08TQRTeP4aDPy4kXggGPZCiN9AYAkhCQQ/FqAS9qJFoYqJGUZGQEm/iSY0naLCxxaUUFqutYCKkatCmuhTKdrfszO7s7uzMM+2SplaIvsxh8ma+9773zTcC7B2O48Tj85qmAQDn/O8Lwq4wxhgArKyu1tXtG77/AADccmYXMK9aXnh9EMLtHd2Nh5vW19crFf8AV7PhAIwD5+VN+erCwmJ9/aHnL156U9SQFzjnGnG3CDMpd6vOGGOu6wLA2Fiw7cSppaXlEnnXZYxVSgiK4STz9pJKYznrTQbHfpl5slPEA0uS1Nzc4ms5/nTiWWUoj5ewsml+Umm66GQ0Ev+hTnxWpjJ6IqfPvXtvYAwAqdTHzo4uURRbW08ODl6WZVlHaKdzWiGmTXPbZpE4AAy4S227gIyx8Sf9gXPp9JdEIuHv6bVtO5v92dd35kjT0UcPR0KhkGM7wnfVsBhzbCtTNDYMCpxV1A6Hwz29Z68P3YzH5wkhhmHIshwI9Dc0NB7YfzCVSgprBbylY+SU5Mnktr5taoRSx7Y9YoqiyLJsWZau6xhjQghCKBKNTk+HMELCBrZyyNQNM7+NGOdfN9S29tPD94YVpcBLunLXdXceiYOXqcgmaKaFTKIijG366nVk4PyF7q5uv79vcnKKUmpZlqc5VPmHlaMk2GZRN4m1mFq+OHBp9PGoz3fs6pVrkiQVtSKltAZZ67C1THboxq1oJNrZ0RkMjsdic6I4u9dPqAWrBfXO7bszM29nRTH5IVntrX+DSx5akPL5vNfNMyD8X/wGw0ZWRRI/lSsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sas to sata\"\n        title=\"sas to sata\"\n        src=\"/static/1848da3866f6c647d92c7a8d7eb88637/d6170/sas-to-sata.png\"\n        srcset=\"/static/1848da3866f6c647d92c7a8d7eb88637/53f68/sas-to-sata.png 213w,\n/static/1848da3866f6c647d92c7a8d7eb88637/df70d/sas-to-sata.png 425w,\n/static/1848da3866f6c647d92c7a8d7eb88637/d6170/sas-to-sata.png 850w,\n/static/1848da3866f6c647d92c7a8d7eb88637/43dd6/sas-to-sata.png 937w\"\n        sizes=\"(max-width: 850px) 100vw, 850px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>When I received the card, I performed a firmware upgrade <a href=\"https://tifan.net/blog/2019/01/28/hp-h220-lsi-2308-9207-8i-stock-firmware-on-dell-r720/\">following this guide from tifan.net</a>. Since the files there may one day disappear, I've uploaded the <a href=\"/61aaba62454edd1f91287113ec8f47ea/PH20.00.07.00-IT.zip\">PH20.00.07.00-IT.zip firmware</a> and <a href=\"/eedb0ec0fd2e81684907d9b57d396d9d/sas2flash.efi\">P14 sas2flash.efi</a> tool on my site too. Here are the EFI shell commands:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">sas2flash.efi -o -e <span class=\"token number\">7</span></span></span>\n<span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">sas2flash.efi -f 2308T207.ROM</span></span>\n<span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">sas2flash.efi -b mptsas2.rom</span></span>\n<span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">sas2flash.efi -b x64sas2.rom</span></span>\n<span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">sas2flash.efi -o -sasaddhi </span></span><span class=\"token output\">&lt;first 7 digits of SN></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"3d-printed-pci-drive-mounts\" style=\"position:relative;\"><a href=\"#3d-printed-pci-drive-mounts\" aria-label=\"3d printed pci drive mounts permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3D Printed PCI Drive Mounts</h3>\n<p>The only free space left in the case were where the PCI slots were. I found a some 3D prints off Thingiverse for hard drive PCI mounts:</p>\n<ul>\n<li><a href=\"https://www.thingiverse.com/thing:133833\">3.5\" mount by pushbx</a></li>\n<li><a href=\"https://www.thingiverse.com/thing:946543\">2.5\" mount by BearTechandTools</a></li>\n</ul>\n<p>I was able to squeeze one 3.5\" and two 2.5\" together on my 3D printer.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 850px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/806108227ee5c763265d88b51cffc2f4/ed7d3/3d-printed-pci-hdd.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 86.3849765258216%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD/klEQVQ4ywXB91NaBwAA4NefGjVEPa9FcTQiRqtGQaJMGQoIiEBEIOzNA2XLXg54hiGiIj4TMCo4orVV06Y9L7nWtnf9u/p9AH9+XiSVLqp1DCZLq5DNCefmREKP17moVHAForhJu2RWOy1Ku1Gh1ypZs1w6i8Vgs4h02ghuHKDRKWQKYRSLZTOomgUWqgs12I+WMXDk4f52RBOvu1VIHJXSsHz8wBRuqKW1BYFo7urpamtH9r3oByjEiVkOG08gKYxg3GcRS4QTBAId+yPpxQ+4fvTkyABhEI3H9ODQPQwqhcWgE4mkwVHsGIGkUMsAbHezWCQOQvlCtb62Vdbo1UsOY2I14veCLie47LA5HKDX5/SGVlaCnnDEZ7ZbSEy22e2VatTA64k+2vhQZy+6vbOrD4Mhkgl6i8ETCrhCIdDtMTtcjkDQ4feDbo/XZ/U4VGajhMRgkpjTdA4bEOIxzOEeRFNjQ2MjCoXCvsKbQUswFvWEo6Dbb7AthRKJYDzmicTCsWAwYIuEwJdjI09b2gi4IUAyOTAz2tvwFNHbhxZJxFbQFF+NQ9lMZmsrCb21e4PRjc3I2oY/vp5YSyaTwY2NIIfHGcC+wo+PATEJ4TV5qKm5RSgWrWWyyXQKymbyxeLWbmlzezcB5XYODnfKcG6vnCsWSqWC2WJU2gwUDr/1eySwb+dNTww3EJY1ZqsrkvDFVrd3isVSOb0D+xIpiUKrM4Nao0WhM8mUmkW5fHqGp05rmDIx6nkfkNOQJpWrbbMboM20tpndLe0dnRzXzs5ql1f5PTidK8RTGahQSkDZlcT6UiCs1LneQDKan43BYIE4qBq313ETRO+KV293uvzhQDQZT20moGw6t71Xhk8vPh6fX1br59Va/eCo6g2ktOs6comMwzEAtSk4yLULBFyjycCf40kkC3L5G4VSpdUZtFq93eE6rp+fnJ0f1eofavU9GHb5YtaIg/UPlSYVANb5KWRnD51Br5TSp5XiRe393c8ff/989/Dw+fHxa+3qZuewsg1XSu+ruRIM5bfd8bQ/lqDqCa3PkUBaP6NivHSoBXAxvl9IvtvPnVT3L89Prq4vbu9uNrNZncG0IJEKhWL+3DyHy5tiMGdmuTwKlYPDALs23v6yoBjRl4vRo4NUBc5+OIWv6ofXJ6Xffjr+6+H276+fvjw+fPn3z/s/7m/vb26u6zu7+ajLWHJKgayFm7Pw/Cr2skluNWsWOPS4aMZi95hS7zSrB/ZsxZaCfRpVUiMPKWR2nTqVyUTCAbdBBhn4QMbAzps5fhmTOtL/XfOzjoYn0DNgmqkeTv+HXPm1PfKpbfkXMaIVegLAbd8MNX3b3YHCdCBFU5MRJet/L7qGXeRAt+4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3d printed pci hdd\"\n        title=\"3d printed pci hdd\"\n        src=\"/static/806108227ee5c763265d88b51cffc2f4/d6170/3d-printed-pci-hdd.png\"\n        srcset=\"/static/806108227ee5c763265d88b51cffc2f4/53f68/3d-printed-pci-hdd.png 213w,\n/static/806108227ee5c763265d88b51cffc2f4/df70d/3d-printed-pci-hdd.png 425w,\n/static/806108227ee5c763265d88b51cffc2f4/d6170/3d-printed-pci-hdd.png 850w,\n/static/806108227ee5c763265d88b51cffc2f4/12c14/3d-printed-pci-hdd.png 1275w,\n/static/806108227ee5c763265d88b51cffc2f4/de891/3d-printed-pci-hdd.png 1700w,\n/static/806108227ee5c763265d88b51cffc2f4/ed7d3/3d-printed-pci-hdd.png 3077w\"\n        sizes=\"(max-width: 850px) 100vw, 850px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>I mounted them with normal screws.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 850px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3bf566a472c7f468b309ac16d60ddfc7/58bb1/3d-printed-mounted.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.23943661971832%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAADnklEQVQozwGTA2z8ALuxrbqvq7mvqbiuqbiuqLivp7eup7eupbatpLOqorGnoK+mna6knayim7CknZWLhZyQi6eblaOVjqCSiwC6saq5r6i5r6i7sqq9ta6+tq6/tq6+tay6sqi5sKa1rKKxqKCwpp2to5q7sKhkX1lgV0+rnpeekYmajIQAxr+2xbyuvbSksKmXo5yIoJmEn5mJta6jsKmfpqCWp6CWraKXqqCXrqSblY6HJCQhWlJHp5uTmo6GlYiAANrVy9jNwr+1o8a+q5WKdZiOcnNuVUlBMVdUSSQmJCUpJWQpFS8dFiUoJyQkIhEUD2FZTqedlJqPh5aJgQDY08vJ2a2ryIubv3SXvG6jpH5lXk0uKBlDQjkdHxwdHxpGQjpZWVMRExAREhEXGRZjW1CroJeckYmYi4MA3tvVeoxlRV00VXBMNVElcXhVbWVULyobRUU9JCckLjEsen96ZWhjFhgVFhgWGBkXZFxRrqObpZqSn5OLANzY0HuPnjVHWkRVZjY2Pn15ant1XCgjFllZUTs+OxQXFBEUEQgKCBETEBETEBodG3JoXY+HgHVrZKyflwDY1M3Z3+HI2eDG0tfDyMq2tqhpY1ApIxdVVE1TVVJKTEdFRkI/QDw1OjcsLy0gIiFnX1RcWllWTUatn5YA4+Dc29rb1tbX7fDv1trdsa6kaGBPJSAVh4J0vruwl5SLenlxd3hxkHpvem1mS0xJS0ZBIiQmXlVOsKGYAOLg3eDj48THyMXJyd/l56mmoltTRyYhFYJ9b8XCtFpaVQwODA8WFVEZCi8VDRAWFhMTEiAiJE9HQJuNgQDTzsTh4d/O0tTS1tfj6eyioaBWT0QmIRZ/eWzCv7FcXFYMDg0cHhweISAZGxoQEA8NDQsYGhs5Mid2aFcAxb2wqqagw8bG0dXUxsrKop6WVk09IRsQgHlsxcC0Xl5ZDA4NHh8dJSYjHx8dEBIQDQ4OEhYXMy4kcGJOAJONh3p0bHp0bHZxanpyZ3JqW2VfVEE/OXx2bLu0p1tZVAUIBxASEQsMCwsMDQwODQsMDBATFzAtJG1eSgB7dnOAenWtpaGvqKKtpqGpo5ykn5efmZCTioCYjX9gW1ElJSEiIh4bGxgZGBUWFhQUExEMDQ4jHxhdTjkAv7Wuv7avuK+otaykrqSbo5qQm5GGk4h8i4Bxg3hnfnNkdmtaal9PX1ZGV049Ukk2UEUyRT0tMy0hTEIrfZuNd/Yej/MAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3d printed mounted\"\n        title=\"3d printed mounted\"\n        src=\"/static/3bf566a472c7f468b309ac16d60ddfc7/d6170/3d-printed-mounted.png\"\n        srcset=\"/static/3bf566a472c7f468b309ac16d60ddfc7/53f68/3d-printed-mounted.png 213w,\n/static/3bf566a472c7f468b309ac16d60ddfc7/df70d/3d-printed-mounted.png 425w,\n/static/3bf566a472c7f468b309ac16d60ddfc7/d6170/3d-printed-mounted.png 850w,\n/static/3bf566a472c7f468b309ac16d60ddfc7/12c14/3d-printed-mounted.png 1275w,\n/static/3bf566a472c7f468b309ac16d60ddfc7/de891/3d-printed-mounted.png 1700w,\n/static/3bf566a472c7f468b309ac16d60ddfc7/58bb1/3d-printed-mounted.png 3612w\"\n        sizes=\"(max-width: 850px) 100vw, 850px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>With the drives and RAID card installed into the system, before wiring up the spaghetti:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 850px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/51e527035de88928c052e228dbfaf094/cd2d1/3d-printed-installed.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80.28169014084506%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD20lEQVQozwHQAy/8AK+jdXFtZY5/apmHa52Lbp+NcKCOcqKRdaaVeqeVfKiXfqKReqSSfaaUf6yYhLKgjrOfirOdiLGahLOcgwCkmW9ucnZVW1toZ2JmZ2J1dW9sbml6e3eEg3x4eXRRTkWjkXPFtZ3Lvq24pIuTdFaylXzBq5rHsJ6XemQAX1VAeYCHVV5kNjtANz1Dc3VyQUdKc3RyZmdhZ2tnW1JEhGtSmIRym4p8mYVwk29RlXZhoId3pY18kHRdAEM5MXqDhz5LUiAkJSEjJSEgHCYlHi0tJzAxJTk9Lk9IOV5KP2JQQkc2JUs5KWBHOzwlGysWCg4GAA8MCgBPRDpsdHU9SFAtMDIsLzMhIh4tLCQlKicjMiZEY1BKZmNSYmZ0b2RLRjx8e3ljYl4WEw8XFBMMDQ4NDg8AST4yVVpUJTM2ISgpKiwuHh8bLCwkGSAcKj0tT3lhUnZrU2phWW9rSl9eSVFTHyIgAAMEDA4QDQ8PDw8PAEU6LExUUDssKj4pJSMqLBoaFikpIRgfGysvJ0hZRjc+OElVTISCb66jip+VhZWGdod0XycjHw4QEA8QEABGOyxMSUQxGReFJBZQLCcPGBcqJx8VGhgfIx81PzASFhMYFA2McVe9nny+p4/HsZy6m3tDOjQICQwQERIAPjYpTkY/QBkXZx4YgSkcHxgTISMdMC8qKSggKzYqGR0YFRUQnZuTpaKckIuEjYd/sqymioN/CgoMExMVADgxJEdCOk8dGVobF1kmHXYwIRIcGS0sJyIjGyQuJRUYFg4PDWViXLGtps3MytPRzsa+uGliXg4PERUWGQBMRTpRUk9bKimJKiYiLCt5LSFgKiMNGxsuNCs3Oi8SFRMUFBFsZVzU0Mru7er08O7x7OenoZ8nJyoZHB4AWFBKYGdrdTU3kDU0MTY1MRcSqSweLR8fISsoJSsoGR0cHBwWUVBFbWxqe3Bvfnl2n5uYjYWEIiIoGBgcAFdQSm5xeFQwMkYSER4PDgsLDVIbFC8bGBEZGhMWFhYZGhEUEhgZFwUFBzUTFiIbIBMWFxISFBobHBwYGwBaU1BcYmobGBczLCg2MzAzMC41NjYzNTUzNTQgIyIMEQ4lJSJHRUM+PDpHRkdQUVVQUVY1NTkcHR8hICMAWVZUVVlcTEpHiYR/hoN/iomHjYqHlpOPk5GMUFJQLDAvYmJen5uSm5eOnZqUo56atrGvo5+fPj9AOTo7AFRSUYGFio2VnoWOmIKLloWOl42SmY2SmY2UnJadpJ+lqqaqrqmqrJ6foJCPjoeJjZCTm62vt8XFzdHR19lHPgExzUJwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3d printed installed\"\n        title=\"3d printed installed\"\n        src=\"/static/51e527035de88928c052e228dbfaf094/d6170/3d-printed-installed.png\"\n        srcset=\"/static/51e527035de88928c052e228dbfaf094/53f68/3d-printed-installed.png 213w,\n/static/51e527035de88928c052e228dbfaf094/df70d/3d-printed-installed.png 425w,\n/static/51e527035de88928c052e228dbfaf094/d6170/3d-printed-installed.png 850w,\n/static/51e527035de88928c052e228dbfaf094/12c14/3d-printed-installed.png 1275w,\n/static/51e527035de88928c052e228dbfaf094/de891/3d-printed-installed.png 1700w,\n/static/51e527035de88928c052e228dbfaf094/cd2d1/3d-printed-installed.png 3704w\"\n        sizes=\"(max-width: 850px) 100vw, 850px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>I re-installed Ubuntu from scratch to be safe. I was able to follow my <a href=\"/install-ubuntu-18.04-on-raid1\">previous post on setting up RAID1 for 18.04</a> on 20.04 with some small wording changes.</p>\n<h2 id=\"zfs-on-linux\" style=\"position:relative;\"><a href=\"#zfs-on-linux\" aria-label=\"zfs on linux permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ZFS on Linux</h2>\n<h3 id=\"importing-the-zfs-zpool-in-linux\" style=\"position:relative;\"><a href=\"#importing-the-zfs-zpool-in-linux\" aria-label=\"importing the zfs zpool in linux permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Importing the ZFS ZPool in Linux</h3>\n<p>First I installed the zfs package:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\"><span class=\"token function\">apt</span> <span class=\"token function\">install</span> zfsutils-linux</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Running <code class=\"language-text\">zpool import</code> lists all the possible pools that can be imported:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">zpool <span class=\"token function\">import</span></span></span>\n\n<span class=\"token output\">   pool: files\n     id: 11082528084113358057\n  state: ONLINE\n status: The pool was last accessed by another system.\n action: The pool can be imported using its name or numeric identifier and the '-f' flag. see: http://zfsonlinux.org/msg/ZFS-8000-EY\n config:\n\n  files       ONLINE\n    raidz2-0  ONLINE\n      sdi     ONLINE\n      sdk     ONLINE\n      sdj     ONLINE\n      sdd     ONLINE\n      sda     ONLINE\n      sdm     ONLINE\n      sdl     ONLINE\n      sdc     ONLINE\n      sdb     ONLINE</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>I imported the pool with the special <code class=\"language-text\">-d /dev/disk/by-id</code> option so it auto-mounts after reboots:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">zpool <span class=\"token function\">import</span> -f -d /dev/disk/by-id files</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>I also performed an upgrade to get the latest features:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">zpool upgrade files</span></span>\n\n<span class=\"token output\">This system supports ZFS pool feature flags.\n\nEnabled the following features on 'files':\n  large_dnode\n  edonr\n  userobj_accounting\n  encryption\n  project_quota\n  allocation_classes\n  resilver_defer\n  bookmark_v2</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Also changed the mountpoint as it mounted to <code class=\"language-text\">/files</code> by default:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">zfs get mountpoint files</span></span>\n<span class=\"token output\">NAME   PROPERTY    VALUE       SOURCE\nfiles  mountpoint  /mnt/files  local\n\n</span><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\"><span class=\"token function\">mkdir</span> /mnt/files</span></span>\n<span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">zfs <span class=\"token builtin class-name\">set</span> <span class=\"token assign-left variable\">mountpoint</span><span class=\"token operator\">=</span>/mnt/files files</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"setting-up-smb-samba\" style=\"position:relative;\"><a href=\"#setting-up-smb-samba\" aria-label=\"setting up smb samba permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setting up SMB (Samba)</h3>\n<p>FreeNAS made sharing zpools easy with GUI options for SMB/CIFS, FTP, etc. I had to set up SMB myself and you can find it in my <a href=\"https://github.com/calvinbui/ansible-monorepo/commit/01ba996ef0777ae61fbc4a725538ff62f6dc8481\">Ansible playbook</a>. The only thing it doesn't do is set <code class=\"language-text\">smbpasswd</code> which isn't possible with Ansible yet.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell-session line-numbers\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\"><span class=\"token function\">sudo</span> smbpasswd -a calvin</span></span>\n<span class=\"token output\">New SMB password:\nRetype new SMB password:\nadded user calvin</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>If you're using Nextcloud like me, I updated the <a href=\"https://docs.nextcloud.com/server/latest/admin_manual/configuration_files/external_storage_configuration_gui.html\">External Storage</a> app to use a local mountpoint instead of SMB.</p>\n<h2 id=\"monitoring\" style=\"position:relative;\"><a href=\"#monitoring\" aria-label=\"monitoring permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Monitoring</h2>\n<p>FreeNAS provided alerts ZFS and disk health events. To replicate this as close as possible, I used different tools. You can these in my <a href=\"https://github.com/calvinbui/ansible-monorepo/commit/4c99e906e805824929a198e5bb87b34ffbb0fd2d\">Ansible ZFS playbook</a>.</p>\n<h3 id=\"zfswatcher\" style=\"position:relative;\"><a href=\"#zfswatcher\" aria-label=\"zfswatcher permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>zfswatcher</h3>\n<p><a href=\"https://github.com/rouben/zfswatcher\">zfswatcher</a> is a ZFS pool monitoring and notification daemon. A <a href=\"https://github.com/Pectojin/docker-zfswatcher\">Docker image is provided by Pectojin</a>. It is able to send email alerts on a <a href=\"https://github.com/damicon/zfswatcher/blob/master/etc/zfswatcher.conf#L54\">variety of ZFS events</a>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 850px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/688834465d1d39411d96e8d371e49d59/75b60/zfswatcher.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.248826291079812%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyUlEQVQI1yXNy07DMBBA0Xxa2WXl1s1jQf+1SKSL/EEWDQgJJOLneGZsR1aJhAhndXe3ulyenw6Huq7btm2apu/7ruuanZTyuDvthBAnKaU8CyHEUUgpq3Ech2GY53maJmsdESKi1lophYjfy+K9jzESkVLKWUMh6EVToBhjZawFAG00AKSUtm1LKTlnmRm8B4AYYymFiAC8QVaEX+ZTBfX4eVQ5r6UUBy6ltK5/zcyIlNc1hEDMOef/c2KcbLx+3F/fXm7vN8/+F+7yuVusCQlTAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"zfswatcher\"\n        title=\"zfswatcher\"\n        src=\"/static/688834465d1d39411d96e8d371e49d59/d6170/zfswatcher.png\"\n        srcset=\"/static/688834465d1d39411d96e8d371e49d59/53f68/zfswatcher.png 213w,\n/static/688834465d1d39411d96e8d371e49d59/df70d/zfswatcher.png 425w,\n/static/688834465d1d39411d96e8d371e49d59/d6170/zfswatcher.png 850w,\n/static/688834465d1d39411d96e8d371e49d59/75b60/zfswatcher.png 1210w\"\n        sizes=\"(max-width: 850px) 100vw, 850px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"scrutiny\" style=\"position:relative;\"><a href=\"#scrutiny\" aria-label=\"scrutiny permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>scrutiny</h3>\n<p><a href=\"https://github.com/AnalogJ/scrutiny\">scrutiny</a> provides a web interface for drive S.M.A.R.T. monitoring. It is also able to send alerts to a lot of services with its <a href=\"https://containrrr.dev/shoutrrr/services/overview/\">shoutrrr implementation</a></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 791px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0f2a009289bcfa106d4a703614f5ac8f/17459/scrutiny.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 109.38967136150235%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAIAAABPIytRAAAACXBIWXMAAAsTAAALEwEAmpwYAAADJ0lEQVQ4y2WT24rsNhBF/f8fFAgJgRAC5ykvechlzky32+6Wbd1Kt5JUkuwg98yQ5BhhhLeqRO3lPXz57ffvfvzlh5+/fP/Try+X2cUCPpmQ/7dsoImp24NLg4yb67xy7QcmzOW+XR/iMm/Kxs/T4N9rPr9s2q/KapekwUUaaXCQAQu1RDVTxUgYM0YKMZe6G0yLczkXjBRTeS5M72rMdbhbzbS6Sj5reeXbTfJJcG3cse8a8QqSG7jw9Q6qq4LPQnBlau2XDcybSNnlSHt1KVlEqvU4HxPjzahEZFOkVn3OBjHXsp8qlTrMoC5v4+vbWEp9sHWa2XEc+0fxVctxnF++XnKmdRUvr+O+P8Wz+GEBtFUaaq3eI5c6pXwcR92bRD8aaYwTSpdSECOXGmM6jqPsLRANzALfxHxnMUal4TJOGkzbWywkQ5iMkkJN88MHNNZdx0lI1fY9lBxSHpRHKi2XFnPpnpc9UQ2RHGYISbiQu9q9fVdLC4kcJot5YM5IsKsGae0i9apgVfB0GzDejNbGddXYVelNwaZAatva3t1+eFDomTdbsMwBc7A5kzIdxwGIo5EQkXngT9Wb1RpMfexc6nA3SvI+WGuNC8UYf/f6w20lNOey1qq1neeltX+5zRxIqZaN19rAWGNdR3Xy0Ig3o7QGtm6lFOu80uZUe/9+82zUfWbjbU4pCan/+OtVKuiNWxHoryDZY7uMU0AEsH/+/bZu4jiO1EqgPHDnAkbjQojkMfUNdgwWUXtcrQ0YwfmA6UNNmMkgOkyD8CHG0itDciF5zC6k89dvcAbjMwwe8/lODlMuFVMZJlBfb/PMBTeGKbkBCGMS0XPmK8jNwEVukxQj3yYlboJr6/a2JyrD4k1sxdUcKvlKtvTN09CTs8qlBEplb5HIxvgZG3oatjw2xtbW2mPZ5vtyHP9B9RmMZfs2GA62VS4rr7Va54WEz94dFSgDjktFRAHjJlTAeMZuj9RnfofBlpWojLf75TqVWmkvIvgRpFHwWJYYk/dhmu9ad5CpUk8Vdw5jZ+BCfMKwPrrT0hOVy9QjgYkwUaIac/E9Ff3MP35X445t29NmAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"scrutiny\"\n        title=\"scrutiny\"\n        src=\"/static/0f2a009289bcfa106d4a703614f5ac8f/17459/scrutiny.png\"\n        srcset=\"/static/0f2a009289bcfa106d4a703614f5ac8f/53f68/scrutiny.png 213w,\n/static/0f2a009289bcfa106d4a703614f5ac8f/df70d/scrutiny.png 425w,\n/static/0f2a009289bcfa106d4a703614f5ac8f/17459/scrutiny.png 791w\"\n        sizes=\"(max-width: 791px) 100vw, 791px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"zfs-zed\" style=\"position:relative;\"><a href=\"#zfs-zed\" aria-label=\"zfs zed permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ZFS ZED</h3>\n<p><a href=\"https://zfsonlinux.org/manpages/0.8.0/man8/zed.8.html\">zed</a> is the built-in ZFS on Linux Event Daemon that monitors events generated by the ZFS kernel. Whenever a new ZFS event occurs, ZED will run any ZEDLETs (ZFS Event Daemon Linkage for Executable Tasks) created under <code class=\"language-text\">/etc/zfs/zed.d/</code>. I didn't add any new ZEDLETs and went with the default provided.</p>\n<p>A mail provider is required on the host as well. I went with <a href=\"https://marlam.de/msmtp/\">msmtp</a> as <code class=\"language-text\">ssmtp</code> was no longer maintained and <code class=\"language-text\">postfix</code> looked too heavy for simple emails. I added all the email configs to the ZED config file at <code class=\"language-text\">/etc/zfs/zed.d/zed.rc</code> and tested with a <code class=\"language-text\">zpool scrub</code>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 850px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7a02234bdd0a754e5313b40a3ee099c0/7bc11/zfs-zed-email.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.460093896713616%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZUlEQVQoz5WRy2rCQBiF8yB2oaVCNyJBKEUqjWmkz2YvW6NGa19Ft5KNKCoqGkUhDslM5+JkYpxSpVBEin78i8OBw+HwK+m0mkjcxGJXqpq5u7tX1UwqlY7Hr5PJW03La1reMArZ7IOm5XXd0PWnXO7RMAq6bhjGs1IqmW9v78Vi8eXl1bJqjcZnvf5hWTXLqplmxTTLpZJZLv+Iw/3qSrVqKYwxjHEYhvJyFMdxbNseDoe+76/Xa0JIFO2256HM5/PJZAIA8DwPIeT7PoQQIUQpJXu+9niexzk/bhZCAACEEH/d3W7nui6l1HVdAADG+GAeh6WUGOPxeLxYLBzHWS6XCCEIYbvdhhDiPZTS05ullGEYdrvd5p7BYCClFELYtg0hJIRgjBlj/4U7nU6z2Wy1WqPRSEoZRdFZzdvtlnM+m816vV6/31+tVod50+mUMcY532w2QRCcDjPGCCGMsSAILv32N+7ENt4urBhTAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"zfs zed email\"\n        title=\"zfs zed email\"\n        src=\"/static/7a02234bdd0a754e5313b40a3ee099c0/d6170/zfs-zed-email.png\"\n        srcset=\"/static/7a02234bdd0a754e5313b40a3ee099c0/53f68/zfs-zed-email.png 213w,\n/static/7a02234bdd0a754e5313b40a3ee099c0/df70d/zfs-zed-email.png 425w,\n/static/7a02234bdd0a754e5313b40a3ee099c0/d6170/zfs-zed-email.png 850w,\n/static/7a02234bdd0a754e5313b40a3ee099c0/7bc11/zfs-zed-email.png 878w\"\n        sizes=\"(max-width: 850px) 100vw, 850px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>","timeToRead":8,"excerpt":"I merged all my home servers together to improve performance while reducing power usage. Preface Adding more drives HP H220 (LSI SAS2308) 3D…","fileAbsolutePath":"/home/runner/work/calvin.me/calvin.me/master/posts/2020/2020-10-30-hyperconverging-my-servers/index.md","frontmatter":{"title":"Hyperconverging My Servers","categories":["Storage","Computers"],"tags":["zfs","freenas","hyperconverging"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#f8c888","images":{"fallback":{"src":"/static/b1155a05ba684365998eb68a76eb2413/ccc8a/thumbnail.png","srcSet":"/static/b1155a05ba684365998eb68a76eb2413/ccc8a/thumbnail.png 150w,\n/static/b1155a05ba684365998eb68a76eb2413/67d4a/thumbnail.png 300w","sizes":"150px"},"sources":[{"srcSet":"/static/b1155a05ba684365998eb68a76eb2413/3554d/thumbnail.webp 150w,\n/static/b1155a05ba684365998eb68a76eb2413/c437f/thumbnail.webp 300w","type":"image/webp","sizes":"150px"}]},"width":150,"height":150}}}}}},"pageContext":{"filter":"/^.*\\/\\d{4}-\\d{2}-\\d{2}-hyperconverging-my-servers\\/.*$/"}},"staticQueryHashes":[]}